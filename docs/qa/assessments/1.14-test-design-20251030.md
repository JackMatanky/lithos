# Test Design: Story 1.14

Date: 2025-10-30
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 6
- Unit tests: 4 (66%)
- Integration tests: 1 (17%)
- E2E tests: 1 (17%)
- Priority distribution: P0: 1, P1: 4, P2: 1, P3: 0

## Test Scenarios by Acceptance Criteria

### AC 1.14.1 – Workspace helper ensures safe temp directory management

| ID             | Level | Priority | Test                                                         | Justification |
|----------------|-------|----------|--------------------------------------------------------------|---------------|
| 1.14-UNIT-001  | Unit  | P0       | `Workspace.Path()` rejects `..` traversal and fails the test | Prevents filesystem escape and data leakage |
| 1.14-UNIT-002  | Unit  | P1       | `Workspace` registers `t.Cleanup` and removes directories on failure | Guarantees cleanup semantics without full integration harness |

### AC 1.14.2 – `CopyFromTestdata` handles fixtures via new helper

| ID             | Level | Priority | Test                                                         | Justification |
|----------------|-------|----------|--------------------------------------------------------------|---------------|
| 1.14-UNIT-003  | Unit  | P1       | Copy single file fixture and preserve 0o600 permissions      | Pure logic using helper; fast feedback |
| 1.14-UNIT-004  | Unit  | P1       | Recursively copy fixture directory and maintain structure    | Validates recursive copy logic without running full suites |

### AC 1.14.3 – Existing suites adopt workspace helper

| ID             | Level | Priority | Test                                                         | Justification |
|----------------|-------|----------|--------------------------------------------------------------|---------------|
| 1.14-INT-001   | Integration | P1  | Run `tests/integration/schema_system_test.go` focusing on workspace setup | Confirms integration suite uses helper without leaking files |

### AC 1.14.4 – Helper unit coverage & AC 1.14.5 documentation

| ID             | Level | Priority | Test                                                         | Justification |
|----------------|-------|----------|--------------------------------------------------------------|---------------|
| 1.14-E2E-001   | E2E   | P1       | Run representative CLI e2e (`lithos_schema_test`) ensuring workspace helper path is used end-to-end | Validates full workflow and documentation alignment |

### AC 1.14.6 – Regression commands executed and evidence captured

| ID             | Level | Priority | Test                                                         | Justification |
|----------------|-------|----------|--------------------------------------------------------------|---------------|
| 1.14-INT-002   | Integration | P2 | Capture outputs from `go test ./...` and `golangci-lint run ./...`, storing references in Change Log | Ensures commands executed and artifacts recorded; lower risk |

## Risk Coverage

- RISK: Workspace escape leading to persisted files → Mitigated by 1.14-UNIT-001 and 1.14-E2E-001.
- RISK: Residual helper usage causing flaky tests → Mitigated by 1.14-INT-001.

## Recommended Execution Order

1. 1.14-UNIT-001
2. 1.14-UNIT-002
3. 1.14-UNIT-003
4. 1.14-UNIT-004
5. 1.14-INT-001
6. 1.14-E2E-001
7. 1.14-INT-002
