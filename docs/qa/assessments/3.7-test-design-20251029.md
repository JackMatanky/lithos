# Test Design: Story 3.7 - FrontmatterService

**Date:** 2025-10-29
**Designer:** Quinn (Test Architect)
**Story:** 3.7 - FrontmatterService
**Epic:** 3 - Vault Caching & Indexing

---

## Test Strategy Overview

- **Total test scenarios:** 12
- **Unit tests:** 12 (100%)
- **Priority distribution:** P0: 8, P1: 4

**Rationale:** FrontmatterService handles extraction and validation of frontmatter from markdown. Tests use fakes for SchemaEngine and Logger. Coverage verifies YAML/TOML parsing, schema validation, field validators, and error handling.

---

## Test Scenarios by Acceptance Criteria

### Extract Method (AC 1, 3)

| ID           | Level | Priority | Test Description                                                     | Justification                                 |
| ------------ | ----- | -------- | -------------------------------------------------------------------- | --------------------------------------------- |
| 3.7-UNIT-001 | Unit  | P0       | Extract parses valid YAML frontmatter correctly                      | Core extraction functionality                   |
| 3.7-UNIT-002 | Unit  | P0       | Extract parses valid TOML frontmatter correctly                      | TOML support                                    |
| 3.7-UNIT-003 | Unit  | P0       | Extract handles missing frontmatter gracefully                       | Edge case handling                              |
| 3.7-UNIT-004 | Unit  | P0       | Extract returns structured error for malformed content               | Error handling                                  |
| 3.7-UNIT-005 | Unit  | P1       | Extract ignores delimiters in code blocks                            | Edge case robustness                             |

### Validate Method (AC 2, 4, 6)

| ID           | Level | Priority | Test Description                                                     | Justification                                 |
| ------------ | ----- | -------- | -------------------------------------------------------------------- | --------------------------------------------- |
| 3.7-UNIT-006 | Unit  | P0       | Validate enforces required fields from schema                        | Schema compliance                              |
| 3.7-UNIT-007 | Unit  | P0       | Validate enforces type constraints without coercion                  | Type safety                                    |
| 3.7-UNIT-008 | Unit  | P0       | Validate preserves unknown fields                                    | FR6/FR7 compliance                             |
| 3.7-UNIT-009 | Unit  | P0       | Validate uses polymorphic field validators                           | Clean validation architecture                  |
| 3.7-UNIT-010 | Unit  | P1       | Validate returns structured FrontmatterError with details            | Error reporting                                 |

### Field Validators (AC 6)

| ID           | Level | Priority | Test Description                                                     | Justification                                 |
| ------------ | ----- | -------- | -------------------------------------------------------------------- | --------------------------------------------- |
| 3.7-UNIT-011 | Unit  | P0       | StringValidator, NumberValidator, DateValidator, BoolValidator work | Polymorphic validation                         |

### Tooling & Dependencies (AC 5, 9)

| ID           | Level | Priority | Test Description                                                     | Justification                                 |
| ------------ | ----- | -------- | -------------------------------------------------------------------- | --------------------------------------------- |
| 3.7-UNIT-012 | Unit  | P0       | `go test ./internal/app/frontmatter` passes with >90% coverage       | Test gate                                       |
| 3.7-UNIT-013 | Unit  | P0       | `golangci-lint run ./internal/app/frontmatter` clean                 | Lint gate                                       |

---

## Test Scenario Details

- Extract tests use goldmark with frontmatter extension; verify parsing of YAML and TOML formats.
- Validate tests use fake SchemaEngine; verify field validation without coercion.
- Field validators tested polymorphically; each validator handles specific types.
- Error scenarios return structured FrontmatterError with schema/field details.
- Coverage targets >90% with comprehensive edge cases.

---

## Risk Coverage

- **RISK-FRONTMATTER-001:** Malformed frontmatter causes crashes → Mitigated by 3.7-UNIT-004.
- **RISK-FRONTMATTER-002:** Schema validation fails silently → Mitigated by 3.7-UNIT-010.
- **RISK-FRONTMATTER-003:** Type coercion breaks data integrity → Mitigated by 3.7-UNIT-007.
- **RISK-FRONTMATTER-004:** Unknown fields lost → Mitigated by 3.7-UNIT-008.

---

## Test Execution Order

1. Extract method tests (001-005).
2. Validate method tests (006-010).
3. Field validator tests (011).
4. Tooling commands (012-013).

---

## Quality Gates

- ✅ All 8 P0 scenarios passing.
- ✅ Lint and unit tests succeed with >90% coverage.
- ✅ Structured errors provide clear feedback.

---

## Summary

This test plan validates FrontmatterService's extraction and validation capabilities, ensuring robust frontmatter processing with schema compliance and clear error reporting.
