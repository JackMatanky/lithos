# Test Design: Story 1.5

Date: 2025-10-28
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 10
- Unit tests: 10 (100%)
- Integration tests: 0 (0%)
- E2E tests: 0 (0%)
- Priority distribution: P0: 10, P1: 0, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1.5.1-1.5.3: Base Error Types

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.5-UNIT-001 | Unit        | P0       | BaseError construction and Error() method | Core error functionality, critical for all error handling |
| 1.5-UNIT-002 | Unit        | P0       | BaseError Unwrap() method | Enables error chains and stdlib compatibility |
| 1.5-UNIT-003 | Unit        | P0       | ValidationError construction and accessors | Property-level validation errors, critical for user feedback |
| 1.5-UNIT-004 | Unit        | P0       | ResourceError construction and accessors | Resource operation errors, critical for system reliability |

### AC1.5.4: Error Wrapping and Unwrapping Tests

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.5-UNIT-005 | Unit        | P0       | errors.Unwrap() compatibility | Ensures stdlib error handling works |
| 1.5-UNIT-006 | Unit        | P0       | errors.Is() and errors.As() compatibility | Critical for error type checking patterns |

### AC1.5.5-1.5.7: Domain-Specific Errors

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.5-UNIT-007 | Unit        | P0       | TemplateError construction and TemplateID() | Domain-specific error context for template operations |
| 1.5-UNIT-008 | Unit        | P0       | SchemaError construction and SchemaName() | Domain-specific error context for schema validation |
| 1.5-UNIT-009 | Unit        | P0       | FrontmatterError construction and Field() | Domain-specific error context for frontmatter parsing |

### AC1.5.8-1.5.9: Helper Functions

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.5-UNIT-010 | Unit        | P0       | Wrap() and WrapWithContext() functions | Error context addition, critical for debugging |

## Risk Coverage

This test design covers the following risks:

- **Error Construction Failures**: P0 tests ensure all error types can be created correctly
- **Unwrapping Compatibility**: P0 tests verify stdlib error functions work
- **Domain Context Loss**: P0 tests ensure domain-specific information is preserved
- **Error Chain Breaks**: P0 tests validate error wrapping maintains chains

## Recommended Execution Order

1. P0 Unit tests (all scenarios) - Execute all in parallel as they are independent
2. No P1/P2 tests identified for this story

## Test Implementation Notes

### Test File Structure

- `internal/shared/errors/types_test.go` - Base error types and unwrapping
- `internal/shared/errors/template_test.go` - TemplateError tests
- `internal/shared/errors/schema_test.go` - SchemaError tests
- `internal/shared/errors/frontmatter_test.go` - FrontmatterError tests
- `internal/shared/errors/helpers_test.go` - Helper function tests

### Test Patterns

- Use table-driven tests for multiple error scenarios
- Test both nil and non-nil cause errors
- Verify error messages include context when cause present
- Test accessor methods return correct values
- Verify Unwrap() returns cause correctly
- Test errors.Is() and errors.As() work with custom errors

### Mock Requirements

None - pure unit tests with no external dependencies.

### Test Data Requirements

- Valid and invalid error messages
- Various cause error types (custom, stdlib, nil)
- Domain-specific values (template IDs, schema names, field names)
- Format strings for WrapWithContext

## Quality Indicators

- All error constructors tested
- All accessor methods tested
- Error() method returns clear messages
- Unwrap() method preserves error chains
- Stdlib error functions (Is/As) work correctly
- Domain-specific context preserved
- Helper functions add context without breaking chains
