# Test Design: Story 1.15

Date: 2025-10-30
Designer: Quinn (Test Architect)

Update 2025-10-31: Schema adapter now decodes directly into domain structs; scenario IDs unchanged.

## Test Strategy Overview

- Total test scenarios: 8
- Unit tests: 3 (38%)
- Integration tests: 3 (38%)
- E2E tests: 1 (12%)
- Manual/Documentation checks: 1 (12%)
- Priority distribution: P0: 2, P1: 3, P2: 3, P3: 0

## Test Scenarios by Acceptance Criteria

### AC 1.15.1 – Consolidate schema directories

| ID             | Level       | Priority | Test                                                            | Justification |
|----------------|-------------|----------|-----------------------------------------------------------------|---------------|
| 1.15-INT-001   | Integration | P1       | Run `tests/integration/config_loading_test.go` ensuring canonical `testdata/schemas` path resolves | Validates runtime code after directory merge |

### AC 1.15.2 – Decide `golden` fixture location

| ID             | Level       | Priority | Test                                                            | Justification |
|----------------|-------------|----------|-----------------------------------------------------------------|---------------|
| 1.15-DOC-001   | Manual      | P2       | Review Change Log and `tests/README.md` to confirm decision on `testdata/golden` is documented | Documentation/decision verification not automatable |

### AC 1.15.3 – Enforce snake_case naming

| ID             | Level       | Priority | Test                                                            | Justification |
|----------------|-------------|----------|-----------------------------------------------------------------|---------------|
| 1.15-UNIT-002  | Unit        | P0       | `testdata.Path` rejects non-snake_case paths (table-driven)      | Prevents invalid fixture names entering runtime |
| 1.15-INT-003   | Integration | P2       | Script to scan `testdata/` ensuring all filenames match snake_case regex | Provides safety net post-migration |

### AC 1.15.4 – Implement `testdata` helper

| ID             | Level       | Priority | Test                                                            | Justification |
|----------------|-------------|----------|-----------------------------------------------------------------|---------------|
| 1.15-UNIT-001  | Unit        | P0       | `testdata.Path` rejects unsupported top-level directories        | Critical guardrail protecting helper usage |
| 1.15-UNIT-003  | Unit        | P1       | `testdata.Open` returns descriptive errors for missing fixtures | Ensures helpful diagnostics without integration harness |

### AC 1.15.5 – Integrate helper with workspace utilities

| ID             | Level       | Priority | Test                                                            | Justification |
|----------------|-------------|----------|-----------------------------------------------------------------|---------------|
| 1.15-E2E-001   | E2E         | P1       | Run representative CLI e2e (`lithos_schema_test`) verifying fixture resolution via new helper | Confirms end-to-end compatibility after refactor |
| 1.15-INT-002   | Integration | P1       | Run `tests/utils/tempfs_test.go` integration subset to ensure helper interop | Validates helper interaction without full CLI run |

### AC 1.15.6 – Document canonical layout

| ID             | Level       | Priority | Test                                                            | Justification |
|----------------|-------------|----------|-----------------------------------------------------------------|---------------|
| 1.15-DOC-001   | Manual      | P2       | (Covered above) Review docs for canonical layout references     | Shared with AC 1.15.2 |

### AC 1.15.7 – Regression commands and helper assertions

| ID             | Level       | Priority | Test                                                            | Justification |
|----------------|-------------|----------|-----------------------------------------------------------------|---------------|
| 1.15-INT-004   | Integration | P2       | Capture outputs from `go test ./...` and `golangci-lint run ./...`, ensuring helper assertion messages are logged | Confirms regression commands run post-migration |

## Risk Coverage

- RISK: Stale fixture references causing runtime failures → Mitigated by 1.15-INT-001 and 1.15-E2E-001.
- RISK: Non-compliant fixture names reintroduced → Mitigated by 1.15-UNIT-002 and 1.15-INT-003.

## Recommended Execution Order

1. 1.15-UNIT-001
2. 1.15-UNIT-002
3. 1.15-UNIT-003
4. 1.15-INT-001
5. 1.15-INT-002
6. 1.15-E2E-001
7. 1.15-INT-003
8. 1.15-DOC-001
9. 1.15-INT-004
