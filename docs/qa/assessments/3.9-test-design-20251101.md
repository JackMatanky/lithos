# Test Design: Story 3.9

Date: 2025-11-01
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 17
- Unit tests: 12 (71%)
- Integration tests: 1 (6%)
- E2E tests: 4 (24%)
- Priority distribution: P0: 16, P1: 0, P2: 1

## Test Scenarios by Acceptance Criteria

### AC1: CommandOrchestrator.IndexVault() implementation

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 3.9-UNIT-001 | Unit        | P0       | Delegates to VaultIndexer.Build | Core delegation logic, no external deps |
| 3.9-UNIT-002 | Unit        | P0       | Logs start message        | Structured logging validation |
| 3.9-UNIT-003 | Unit        | P0       | Logs summary statistics   | Stats logging verification |
| 3.9-UNIT-004 | Unit        | P0       | Wraps errors with context | Error handling pattern |
| 3.9-UNIT-005 | Unit        | P0       | Returns IndexStats        | Return value validation |

### AC2: CLI index command registration and execution

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 3.9-UNIT-006 | Unit        | P0       | buildIndexCommand creates cobra.Command | Command structure validation |
| 3.9-UNIT-007 | Unit        | P0       | handleIndexCommand calls IndexVault | CommandPort invocation |
| 3.9-UNIT-008 | Unit        | P0       | handleIndexCommand displays stats | Success path output |
| 3.9-UNIT-009 | Unit        | P0       | handleIndexCommand returns error on failure | Error handling in CLI |
| 3.9-UNIT-010 | Unit        | P0       | displayIndexStats formats output | Output formatting |
| 3.9-UNIT-011 | Unit        | P0       | displayIndexStats shows warnings | Failure indicators |
| 3.9-INT-001  | Integration | P0       | CLI command registered in help | Command registration verification |

### AC3: Integration/E2E testing of lithos index

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 3.9-E2E-001  | E2E         | P0       | Execute lithos index command | Full CLI workflow |
| 3.9-E2E-002  | E2E         | P0       | Verify cache files created | Cache persistence |
| 3.9-E2E-003  | E2E         | P0       | Verify CLI output format  | User-facing output validation |
| 3.9-E2E-004  | E2E         | P0       | Verify FR9 query capabilities | Functional requirement validation |

### AC4: Documentation and help output

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 3.9-UNIT-012 | Unit        | P0       | Command help text matches requirements | Help text validation |
| 3.9-MANUAL-001 | Manual    | P2       | README documentation updated | Documentation completeness |

## Risk Coverage

This story implements core CLI functionality for vault indexing, which is critical for the tool's operation. All scenarios are P0 priority due to the impact on core functionality.

## Recommended Execution Order

1. P0 Unit tests (CommandOrchestrator and CLI adapter logic)
2. P0 Integration test (CLI command registration)
3. P0 E2E tests (full lithos index workflow)
4. P2 Manual test (documentation review)</content>
<parameter name="filePath">docs/qa/assessments/3.9-test-design-20251101.md
