# Test Design: Story 3.13

Date: 2025-01-12
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 24
- Unit tests: 12 (50%)
- Integration tests: 12 (50%)
- E2E tests: 0 (0%)
- Priority distribution: P0: 24, P1: 0, P2: 0

## Test Scenarios by Acceptance Criteria

### AC1: ByPath and ByBasename query methods return correct results for all note lookups

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 3.13-UNIT-001 | Unit        | P0       | Path extraction from NoteID | Pure string manipulation logic |
| 3.13-UNIT-002 | Unit        | P0       | Basename extraction logic | Pure string manipulation logic |
| 3.13-INT-001  | Integration | P0       | ByPath query with populated index | Service-cache interaction |
| 3.13-INT-002  | Integration | P0       | ByBasename query with populated index | Service-cache interaction |
| 3.13-INT-003  | Integration | P0       | ByPath query with complex vault paths | Multi-level path handling |
| 3.13-INT-004  | Integration | P0       | ByBasename query with extension handling | Filename parsing edge cases |

### AC2: Frontmatter queries handle all YAML value types without panicking

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 3.13-UNIT-003 | Unit        | P0       | String value frontmatter queries | Pure comparison logic |
| 3.13-UNIT-004 | Unit        | P0       | Numeric value frontmatter queries | Pure comparison logic |
| 3.13-UNIT-005 | Unit        | P0       | Boolean value frontmatter queries | Pure comparison logic |
| 3.13-UNIT-006 | Unit        | P0       | Array value frontmatter queries | Complex type handling |
| 3.13-UNIT-007 | Unit        | P0       | Map value frontmatter queries | Complex type handling |
| 3.13-UNIT-008 | Unit        | P0       | Null/nil value frontmatter queries | Edge case handling |
| 3.13-INT-005  | Integration | P0       | Frontmatter query service integration | Service with complex data types |
| 3.13-INT-006  | Integration | P0       | Mixed type frontmatter in cache | Cache deserialization safety |

### AC3: Fresh installation works without requiring manual cache directory creation

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 3.13-INT-007  | Integration | P0       | QueryService initialization without cache directory | Service startup behavior |
| 3.13-INT-008  | Integration | P0       | Automatic cache directory creation | File system interaction |

### AC4: Type-agnostic frontmatter lookups work correctly (int 2 matches float 2.0)

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 3.13-UNIT-009 | Unit        | P0       | Int to float type normalization | Pure type conversion logic |
| 3.13-UNIT-010 | Unit        | P0       | Float to int type normalization | Pure type conversion logic |
| 3.13-UNIT-011 | Unit        | P0       | Numeric comparison with tolerance | Pure comparison logic |
| 3.13-INT-009  | Integration | P0       | Type-agnostic frontmatter query execution | Service with type conversion |

### AC5: All query indices are properly populated

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 3.13-INT-010  | Integration | P0       | byID index population | Cache refresh operation |
| 3.13-INT-011  | Integration | P0       | byPath index population | Cache refresh operation |
| 3.13-INT-012  | Integration | P0       | byBasename index population | Cache refresh operation |
| 3.13-INT-013  | Integration | P0       | byFileClass index population | Cache refresh operation |
| 3.13-INT-014  | Integration | P0       | byFrontmatter index population | Cache refresh operation |

### AC6: Query service handles missing or empty cache gracefully

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 3.13-INT-015  | Integration | P0       | Query with missing cache directory | Error handling behavior |
| 3.13-INT-016  | Integration | P0       | Query with empty cache file | Edge case handling |
| 3.13-INT-017  | Integration | P0       | Query with corrupted cache data | Robustness testing |

## Risk Coverage

This test design addresses the following risks:

- Query functionality failures affecting user ability to find notes
- Data type handling errors causing application crashes
- Installation issues blocking new users
- Type conversion bugs in frontmatter queries
- Index population failures leading to incomplete search results
- Cache handling errors causing service unavailability

## Recommended Execution Order

1. P0 Unit tests (fail fast on logic errors)
2. P0 Integration tests (validate service behavior)
3. No P1+ tests identified for this critical functionality

## Coverage Analysis

- **Unit Coverage**: 50% - Focuses on pure logic components (path extraction, type normalization, comparison logic)
- **Integration Coverage**: 50% - Validates service-level interactions with cache and data handling
- **E2E Coverage**: 0% - Not applicable for this service-level functionality
- **Coverage Gaps**: None identified - all ACs have comprehensive test scenarios</content>
<parameter name="filePath">docs/qa/assessments/3.13-repair-query-layer-breakdown-test-design-20250112.md
