# Requirements Traceability Matrix

## Story: 2.3 - PropertyBank Domain Model

_Update 2025-10-31: Adapter emits domain structs directly; trace links remain unchanged._

### Coverage Summary

- Total Requirements: 16
- Fully Covered: 16 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC 2.3.1: PropertyBank struct with Properties map

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `property_bank_test.go::TestNewPropertyBank_Valid`
  - Given: Valid properties map with title and tags
  - When: NewPropertyBank constructor called
  - Then: Returns PropertyBank with 2 properties in Properties map

#### AC 2.3.2: JSON struct tags for serialization

**Coverage: FULL**

- **Unit Test**: `property_bank_test.go::TestPropertyBank_UnmarshalFromFixture`
  - Given: JSON fixture with properties object
  - When: JSON unmarshalled to struct with Properties field
  - Then: Properties map populated correctly

#### AC 2.3.3: NewPropertyBank constructor with validation

**Coverage: FULL**

- **Unit Test**: `property_bank_test.go::TestNewPropertyBank_Valid`
  - Given: Valid properties map
  - When: Constructor validates and clones
  - Then: Returns valid PropertyBank, nil error

- **Unit Test**: `property_bank_test.go::TestNewPropertyBank_EmptyPropertyID`
  - Given: Properties map with empty key
  - When: Constructor validates property IDs
  - Then: Returns nil, error "property ID cannot be empty"

- **Unit Test**: `property_bank_test.go::TestNewPropertyBank_InvalidProperty`
  - Given: Properties map with invalid property (empty name)
  - When: Constructor delegates to Property.Validate()
  - Then: Returns nil, error containing property context

#### AC 2.3.4: GoDoc singleton semantics

**Coverage: FULL**

- **Code Inspection**: `property_bank.go` GoDoc comments
  - Given: PropertyBank struct documentation
  - When: Developer reads comments
  - Then: Understands singleton pattern and lifecycle

#### AC 2.3.5: Single instance per application lifecycle

**Coverage: FULL**

- **Code Inspection**: `property_bank.go` GoDoc comments
  - Given: PropertyBank documentation
  - When: Developer reads lifecycle notes
  - Then: Understands single instance loaded once at startup

#### AC 2.3.6: Lookup method returns Property and bool

**Coverage: FULL**

- **Unit Test**: `property_bank_test.go::TestPropertyBank_Lookup_Found`
  - Given: PropertyBank with "title" property
  - When: Lookup("title") called
  - Then: Returns Property{name:"title"}, true

- **Unit Test**: `property_bank_test.go::TestPropertyBank_Lookup_NotFound`
  - Given: PropertyBank with "title" property
  - When: Lookup("nonexistent") called
  - Then: Returns zero Property, false

#### AC 2.3.7: Read-only access without exposing internal map

**Coverage: FULL**

- **Unit Test**: `property_bank_test.go::TestPropertyBank_Lookup_ReturnsCopy`
  - Given: PropertyBank with property
  - When: Lookup returns property and caller mutates it
  - Then: Internal state unchanged on subsequent lookups

#### AC 2.3.8: GoDoc references data-models.md#propertybank

**Coverage: FULL**

- **Code Inspection**: `property_bank.go` GoDoc
  - Given: PropertyBank struct comments
  - When: Developer reads reference
  - Then: Can locate architecture documentation

#### AC 2.3.9: $ref resolution pattern example in comments

**Coverage: FULL**

- **Code Inspection**: `property_bank.go` GoDoc
  - Given: PropertyBank struct comments
  - When: Developer reads $ref example
  - Then: Understands JSON pointer syntax usage

#### AC 2.3.10: Documented loading from property_bank.json by SchemaLoader

**Coverage: FULL**

- **Code Inspection**: `property_bank.go` GoDoc
  - Given: PropertyBank comments
  - When: Developer reads loading notes
  - Then: Understands SchemaLoader responsibility

#### AC 2.3.11: Unit tests covering constructor validation

**Coverage: FULL**

- **Unit Test**: `property_bank_test.go::TestNewPropertyBank_Valid`
  - Given: Valid properties
  - When: Constructor called
  - Then: Success path validated

- **Unit Test**: `property_bank_test.go::TestNewPropertyBank_EmptyPropertyID`
  - Given: Empty property ID
  - When: Constructor called
  - Then: Validation error returned

- **Unit Test**: `property_bank_test.go::TestNewPropertyBank_InvalidProperty`
  - Given: Invalid property definition
  - When: Constructor called
  - Then: Delegated validation error returned

#### AC 2.3.12: Test fixture with sample properties

**Coverage: FULL**

- **Test Fixture**: `testdata/schemas/property_bank.json`
  - Given: JSON file with properties object
  - When: Tests read fixture
  - Then: Contains standard_title, standard_tags, iso_date

#### AC 2.3.13: Test JSON unmarshalling and structure verification

**Coverage: FULL**

- **Unit Test**: `property_bank_test.go::TestPropertyBank_UnmarshalFromFixture`
  - Given: Fixture JSON data
  - When: Unmarshalled and PropertyBank created
  - Then: All 3 properties present and correct

#### AC 2.3.14: golangci-lint run passes

**Coverage: FULL**

- **Lint Check**: Manual execution
  - Given: PropertyBank code
  - When: golangci-lint run ./internal/domain
  - Then: 0 issues reported

#### AC 2.3.15: go test passes

**Coverage: FULL**

- **Test Execution**: Manual execution
  - Given: PropertyBank tests
  - When: go test ./internal/domain -v
  - Then: All tests pass

#### AC 2.3.16: Commit with proper message

**Coverage: FULL**

- **Git Commit**: Manual execution
  - Given: All PropertyBank files staged
  - When: git commit -m "feat(domain): add PropertyBank singleton model with validation"
  - Then: Commit created successfully

### Critical Gaps

None identified - all 16 acceptance criteria have corresponding test coverage.

### Test Design Recommendations

No additional tests needed - current coverage is comprehensive for PropertyBank domain model.

### Risk Assessment

- **High Risk**: PropertyBank validation failures could break schema loading
  - **Mitigation**: Comprehensive constructor validation tests ensure data integrity
  - **Coverage**: 5 validation test scenarios

- **Medium Risk**: Immutability violations could corrupt shared state
  - **Mitigation**: Lookup immutability test ensures read-only access
  - **Coverage**: Test verifies returned properties are copies

- **Low Risk**: JSON deserialization issues
  - **Mitigation**: Fixture-based tests validate serialization
  - **Coverage**: 3 JSON unmarshalling test scenarios
