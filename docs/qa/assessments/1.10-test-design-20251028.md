# Test Design: Story 1.10

Date: 2025-10-28
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 17 (94%)
- Integration tests: 1 (6%)
- E2E tests: 0 (0%)
- Priority distribution: P0: 18 (100%)

## Test Scenarios by Acceptance Criteria

### AC 1.10.1: TemplateEngine Constructor

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.10-UNIT-001 | Unit        | P0       | Constructor creates service with dependencies | Core service initialization, critical for all operations |

### AC 1.10.2: Load Method

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.10-UNIT-002 | Unit        | P0       | Load delegates to TemplatePort correctly | Service delegation pattern, critical for template access |
| 1.10-UNIT-003 | Unit        | P0       | Load logs operation with template ID | Observability requirement, debug logging |
| 1.10-UNIT-004 | Unit        | P0       | Load propagates errors from port | Error handling, prevents silent failures |

### AC 1.10.3-1.10.4: Basic Template Functions

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.10-UNIT-005 | Unit        | P0       | now() function returns formatted timestamp | Time formatting logic, user-facing template function |
| 1.10-UNIT-006 | Unit        | P0       | toLower() converts string to lowercase | String manipulation, core template function |
| 1.10-UNIT-007 | Unit        | P0       | toUpper() converts string to uppercase | String manipulation, core template function |

### AC 1.10.5: File Path Control Functions

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.10-UNIT-008 | Unit        | P0       | path() returns empty string (Epic 1) | Placeholder function, future Epic 3 integration |
| 1.10-UNIT-009 | Unit        | P0       | folder() returns parent directory | File path manipulation, user-facing function |
| 1.10-UNIT-010 | Unit        | P0       | basename() strips path and extension | File path manipulation, user-facing function |
| 1.10-UNIT-011 | Unit        | P0       | extension() returns file extension | File path manipulation, user-facing function |
| 1.10-UNIT-012 | Unit        | P0       | join() uses OS-appropriate path separator | Cross-platform path handling, critical for compatibility |
| 1.10-UNIT-013 | Unit        | P0       | vaultPath() returns Config.VaultPath | Configuration access, integration with vault system |

### AC 1.10.6: Render Method

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.10-UNIT-014 | Unit        | P0       | Render executes static template successfully | Core rendering workflow, critical user functionality |
| 1.10-UNIT-015 | Unit        | P0       | Render handles template not found error | Error handling, prevents crashes on missing templates |
| 1.10-UNIT-016 | Unit        | P0       | Render handles parse error with TemplateError | Template syntax validation, user-friendly error messages |
| 1.10-UNIT-017 | Unit        | P0       | Render handles execute error with TemplateError | Runtime error handling, template execution safety |

### AC 1.10.7-1.10.8: Mock and Unit Tests

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.10-UNIT-018 | Unit        | P0       | MockTemplatePort implements TemplatePort interface | Test infrastructure, enables all unit testing |

### AC 1.10.9: Integration Test

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.10-INT-001  | Integration | P0       | Render static template with all functions end-to-end | Complete workflow validation, real template processing |

### AC 1.10.10-1.10.11: Quality Gates

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 1.10-UNIT-019 | Unit        | P0       | All unit tests pass (go test ./internal/app) | Quality gate, ensures functionality works |
| 1.10-INT-002  | Integration | P0       | All integration tests pass (go test ./tests/integration) | Quality gate, ensures end-to-end functionality |
| 1.10-UNIT-020 | Unit        | P0       | Linting passes (golangci-lint run --fix internal/app) | Code quality gate, prevents technical debt |

## Risk Coverage

### Critical Risks Addressed

- **Template parsing failures**: Covered by parse error tests (UNIT-016)
- **Runtime execution errors**: Covered by execute error tests (UNIT-017)
- **Missing template handling**: Covered by not found error tests (UNIT-015)
- **Cross-platform path issues**: Covered by join() OS separator tests (UNIT-012)
- **Configuration access failures**: Covered by vaultPath() config tests (UNIT-013)
- **Function registration errors**: Covered by individual function tests (UNIT-005 through UNIT-013)

### Test Coverage Goals

- Unit test coverage: >90% for service code
- Integration test coverage: 100% for critical rendering workflow
- All template functions tested individually and in combination
- Error paths tested for robustness

## Recommended Execution Order

1. P0 Unit tests (fail fast on core functionality)
2. P0 Integration tests (validate end-to-end workflow)
3. Quality gate verification (linting and test execution)

## Test Environment Requirements

### Unit Tests
- MockTemplatePort for dependency injection
- Test templates with known content
- Config mock with VaultPath set
- Logger mock or test logger

### Integration Tests
- Real template files from testdata/templates/
- Golden files for expected output comparison
- Config with valid VaultPath
- Real logger for integration validation

## Test Data Requirements

- Static template file: testdata/templates/static-template.md
- Expected output: testdata/golden/static-template-expected.md
- Template with all function usages for integration test
- Invalid template for parse error testing
- Template with runtime errors for execute error testing

## Success Criteria

- All 18 test scenarios implemented and passing
- TemplateEngine service fully validated at unit and integration levels
- All custom functions tested individually and in combination
- Error handling validated for all failure modes
- Cross-platform path handling verified
- Quality gates (linting, test coverage) met
