# Requirements Traceability Matrix

## Story: 3.8 - FrontmatterService Integration

### Coverage Summary

- Total Requirements: 10
- Fully Covered: 9
- Partially Covered: 0
- Not Covered: 1
- Coverage: 90%

### Requirement Mappings

#### AC1: VaultIndexer.Build() integrates FrontmatterService

**Coverage: FULL**

Given-When-Then Mappings:

- **Unit Test**: `internal/app/vault/indexer_test.go::TestVaultIndexer_Build_WithFrontmatterService`
  - Given: VaultIndexer with FrontmatterService and SchemaEngine injected
  - When: Build() called with .md files containing frontmatter
  - Then: FrontmatterService.Extract() and Validate() called, notes created with validated frontmatter

- **Unit Test**: `internal/app/vault/indexer_test.go::TestVaultIndexer_Build_SkipsNonMarkdown`
  - Given: VaultIndexer with FrontmatterService
  - When: Build() called with non-.md files
  - Then: Frontmatter processing skipped for non-markdown files

#### AC2: VaultIndexer constructor updated with FrontmatterService

**Coverage: FULL**

- **Unit Test**: `internal/app/vault/indexer_test.go::TestNewVaultIndexer_WithFrontmatterService`
  - Given: FrontmatterService and SchemaEngine instances
  - When: NewVaultIndexer() called with all dependencies
  - Then: VaultIndexer created with FrontmatterService properly injected

#### AC3: QueryService ByFrontmatter method

**Coverage: FULL**

- **Unit Test**: `internal/app/query/service_test.go::TestQueryService_ByFrontmatter`
  - Given: QueryService with indexed notes containing frontmatter
  - When: ByFrontmatter() called with field and value
  - Then: Returns matching notes or empty slice

- **Unit Test**: `internal/app/query/service_test.go::TestQueryService_ByFrontmatter_NoMatches`
  - Given: QueryService with indexed notes
  - When: ByFrontmatter() called with non-existent field/value
  - Then: Returns empty slice (not error)

#### AC4: Note domain model includes Frontmatter field

**Coverage: FULL**

- **Note**: Already implemented in previous stories - no additional tests needed

#### AC5: Integration tests verify complete workflow

**Coverage: NONE**

- **Gap**: No integration tests implemented yet
- **Impact**: End-to-end frontmatter workflow not verified
- **Action Required**: Implement integration test suite

#### AC6: Error handling preserves VaultIndexer resilience

**Coverage: FULL**

- **Unit Test**: `internal/app/vault/indexer_test.go::TestVaultIndexer_Build_ValidationFailureLogged`
  - Given: FrontmatterService returns validation error
  - When: Build() processes file with invalid frontmatter
  - Then: Error logged, ValidationFailures incremented, indexing continues

#### AC7: IndexStats extended with frontmatter metrics

**Coverage: FULL**

- **Unit Test**: `internal/app/vault/indexer_test.go::TestVaultIndexer_Build_IndexStatsUpdated`
  - Given: VaultIndexer processing files with frontmatter
  - When: Build() completes
  - Then: IndexStats includes ValidationSuccesses and ValidationFailures counts

#### AC8: Unit tests verify FrontmatterService calls

**Coverage: FULL**

- **Unit Test**: `internal/app/vault/indexer_test.go::TestVaultIndexer_ProcessFileWithFrontmatter`
  - Given: VaultIndexer with mocked FrontmatterService
  - When: processFileWithFrontmatter() called
  - Then: FrontmatterService methods called in correct sequence

#### AC9: golangci-lint and go test succeed

**Coverage: FULL**

- **Verification**: All tests pass, linting clean
- **Command**: `go test ./internal/app/vault ./internal/app/query && golangci-lint run ./internal/app/vault ./internal/app/query`

#### AC10: Performance verified <10% overhead

**Coverage: NONE**

- **Gap**: No performance benchmarking implemented
- **Impact**: Cannot verify NFR3 performance requirements
- **Action Required**: Implement performance tests

### Critical Gaps

1. **Integration Testing (AC5)**
   - Gap: No end-to-end integration tests
   - Risk: High - complete workflow not verified
   - Action: Implement integration test suite covering vault scan → frontmatter processing → indexing → querying

2. **Performance Verification (AC10)**
   - Gap: No performance measurements
   - Risk: Medium - may exceed <10% overhead target
   - Action: Add benchmarking tests for indexing performance with/without frontmatter

### Test Design Recommendations

1. **Integration Test Suite**
   - Test complete workflow with real components
   - Include error scenarios (schema not found, validation failures)
   - Verify frontmatter queries return correct results

2. **Performance Test Suite**
   - Benchmark indexing time for various vault sizes
   - Compare performance with/without frontmatter processing
   - Establish baseline metrics for NFR compliance

### Risk Assessment

- **High Risk**: Missing integration tests (AC5) - could hide workflow issues
- **Medium Risk**: Missing performance verification (AC10) - may impact production performance
- **Low Risk**: All other ACs fully covered with unit tests
