# Tech Stack

This is the DEFINITIVE technology selection section. All technology choices documented here serve as the single source of truth for the project. Any deviations from these selections must be documented with architectural decision records.

## Cloud Infrastructure

**N/A for MVP** - Lithos operates entirely on local file systems with no cloud dependencies. CI/CD for releases uses GitHub Actions (documented in Infrastructure & Deployment section).

## Technology Stack Table

**Versioning Strategy:** Pin to specific minor versions (e.g., `v1.9.x`) to receive patch updates automatically while maintaining compatibility. Review and update dependencies quarterly. Go version specifies minimum; recommend using latest stable patch release within the minor version.

| Category                       | Technology                        | Version                | Purpose                                   | Rationale                                                                                                                                                                                                                                                                                                                                                                          |
| ------------------------------ | --------------------------------- | ---------------------- | ----------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Core Language & Runtime**    |
| Language                       | Go                                | 1.23+ (min 1.23.0)     | Primary development language              | Modern features (iterators, improved errors.Join), excellent CLI ecosystem. Minimum 1.23 provides testing improvements needed for Epic 1.1/4.1. Latest stable: 1.25.2 (Oct 2025).                                                                                                                                                                                                  |
| **CLI & Configuration**        |
| CLI Framework                  | github.com/spf13/cobra            | v1.9.1                 | Command structure & parsing               | Industry standard for Go CLIs (used by kubectl, gh, hugo). Robust subcommand support, excellent flag handling. PRD explicitly specifies. Enables future TUI adapter without core changes.                                                                                                                                                                                          |
| Configuration                  | github.com/spf13/viper            | v1.21.0                | Config file management                    | Seamless Cobra integration, supports YAML/ENV/flags hierarchy. PRD explicitly specifies. Handles `lithos.yaml` directory traversal search. Latest release Sep 2025.                                                                                                                                                                                                                |
| **Data Processing**            |
| YAML Parsing                   | github.com/goccy/go-yaml          | v1.17.1                | Schema YAML processing                    | Superior performance critical for vault indexing (PRD: <300ms render). Chosen over `go-yaml/yaml` for 2-3x speed improvement. Used for schema validation and processing. Frontmatter parsing handled by goldmark-frontmatter extension. Actively maintained.                                                                                                                                                                                                                                 |
| Frontmatter Extraction         | go.abhg.dev/goldmark/frontmatter  | v0.2.0                 | Type-safe frontmatter extraction with goldmark | Specialized goldmark extension providing production-ready YAML/TOML frontmatter parsing with type-safe API. Chosen for robust edge case handling, performance optimization, and seamless goldmark integration. Supports both `---` (YAML) and `+++` (TOML) delimiters. Actively maintained. |
| Markdown Processing            | github.com/yuin/goldmark          | v1.7.4                | Fast markdown parser/renderer for enhanced vault processing | Extensible markdown parser with AST access for frontmatter extraction, heading parsing, and template rendering. Chosen for performance (2-3x faster than custom implementations) and CommonMark compliance. Enables future markdown features without custom development. Actively maintained (2025 releases). |
| **Schema & Property Bank**     |
| Schema Definition Format       | JSON                              | encoding/json (stdlib) | Schema and property bank definitions      | JSON chosen over YAML for MVP simplicity: stdlib unmarshaling (~20 LOC vs ~50 LOC custom YAML), easier Go struct mapping, sufficient expressiveness for schema definitions. Frontmatter remains YAML (Obsidian standard). Schemas stored in `schemas/*.json`, property banks in `schemas/properties/*.json`. Post-MVP: Consider YAML if community prefers (trivial adapter swap). |
| Template Engine                | text/template (stdlib)            | Go 1.23+               | Template rendering & function registry    | Go stdlib template engine. PRD explicitly bases design on this. Zero external dependencies. Provides variable substitution and control flow.                                                                                                                                                                                                                                       |
| **Storage & Indexing**         |
| Index Storage (MVP)            | File-based JSON                   | encoding/json (stdlib) | Persistent note cache                     | Minimizes dependencies, portable across platforms. PRD specifies custom file-based cache for MVP. Stored in `.lithos/cache/*.json`. One file per note for simple invalidation.                                                                                                                                                                                                     |
| **User Interaction**           |
| Interactive Prompts            | github.com/manifoldco/promptui    | v0.9.0                 | Text input & selection UI                 | Clean API, good terminal UX for Epic 5 interactive features. PRD explicitly specifies. **Note: Last release Oct 2021 - mature/stable but unmaintained. InteractivePort abstraction enables future migration to `charmbracelet/huh` when adding TUI (Post-MVP Phase 4).**                                                                                                           |
| Fuzzy Finder                   | github.com/ktr0731/go-fuzzyfinder | v0.8.0                 | Interactive template selection            | fzf-like fullscreen experience, minimal implementation overhead for `lithos find` command. PRD explicitly specifies. Active maintenance (published Apr 2025).                                                                                                                                                                                                                      |
| Terminal Utilities             | golang.org/x/term                 | v0.25.0                | TTY detection, terminal sizing            | Required for interactive UI libraries. Enables: (1) Detecting if output is TTY for color control, (2) Terminal width for formatting, (3) Raw mode for prompts. Transitive dependency of promptui/fuzzyfinder but documented explicitly for architectural clarity.                                                                                                                  |
| **Observability**              |
| Logging                        | github.com/rs/zerolog             | v1.34.0                | Structured logging                        | High-performance zero-allocation JSON logger with CLI-friendly pretty-print mode. PRD explicitly specifies. Supports both machine-readable (JSON) and human-readable (colorized) output. Latest release Mar 2025.                                                                                                                                                                  |
| **Development & Release**      |
| Testing                        | testing (stdlib)                  | Go 1.23+               | Unit & integration tests                  | Table-driven tests, subtests, fuzzing support, test coverage reporting. No external dependencies. Epic 1.1 test vault + Epic 5.1 interactive test harness.                                                                                                                                                                                                                         |
| Release Tooling                | github.com/goreleaser/goreleaser  | v2.12.5                | Cross-platform builds & distribution      | De-facto standard for Go releases. Automates building for multiple OS/arch (macOS x86_64/ARM64, Linux x86_64/ARM64, Windows x86_64), generates release notes, publishes to GitHub releases. PRD specifies. Deferred to post-MVP per Epic 1 scope reduction. Latest release Oct 2025.                                                                                               |
| **Standard Library Utilities** |
| File System                    | os, path/filepath (stdlib)        | Go 1.23+               | Vault scanning, file I/O                  | Explicit choice to use stdlib over abstraction libraries (e.g., `afero`). Aligns with "Standard Library First" principle. Provides cross-platform path handling.                                                                                                                                                                                                                   |
| Atomic File Writes             | github.com/moby/sys/atomicwriter  | v0.1.0                 | Atomic cache writes                       | Drop-in replacement for `os.WriteFile` with atomic guarantees (temp file + rename). Prevents partial writes on crash/disk-full. Battle-tested in Docker/Moby production. Actively maintained (97 contributors, 2025 releases). Used for cache persistence in `.lithos/cache/`. Stdlib `os.WriteFile` is NOT atomic and can leave corrupted files.                                  |
| Time/Date                      | time (stdlib)                     | Go 1.23+               | Template date functions                   | Powers `{{ now "2006-01-02" }}` template function. PRD specifies custom date formats using Go time layout syntax. No external date libraries needed.                                                                                                                                                                                                                               |
| String Processing              | strings, unicode (stdlib)         | Go 1.23+               | Template string functions                 | Powers `toLower`, `toUpper`, wikilink generation template functions. Stdlib sufficient for MVP; defer `golang.org/x/text` for advanced Unicode normalization to post-MVP if needed.                                                                                                                                                                                                |

## Library Maintenance Notes

**Actively Maintained (2025):**

- ✅ Cobra, Viper, go-yaml, zerolog, goreleaser, go-fuzzyfinder - All have 2025 releases

**Stable but Unmaintained:**

- ⚠️ **promptui** (last release Oct 2021) - Chosen for MVP due to simplicity and proven stability. Hexagonal architecture's InteractivePort abstraction protects against lock-in. **Migration path:** When implementing TUI (Post-MVP Phase 4), migrate to `charmbracelet/huh` v2+ which integrates with BubbleTea framework and provides active maintenance, better accessibility support, and cross-platform compatibility.

**Post-MVP Technology Roadmap:**

- **BoltDB** (`go.etcd.io/bbolt`) - Replace file-based JSON cache for read-optimized performance
- **charmbracelet/huh** - Replace promptui when adding TUI support (Phase 4)
- **charmbracelet/bubbletea** - TUI framework for Phase 4 implementation
