# Story 2.9: Review Epic 2 Testing Alignment

## Status

Approved

## Story

As a QA lead, I want to audit the testing readiness of Epic 2 artifacts, so that we confirm every testing goal is satisfied and fully documented.

## Acceptance Criteria

**Testing Robustness Requirements:**

2.8.1: For every Epic 2 story (`docs/stories/2.1`–`2.7`), compile the recommended tests from the story Acceptance Criteria and related QA artifacts (gates, risk/NFR/test-design/trace reports) and verify the corresponding automated tests exist and cover the specified behaviors.

2.8.2: Where coverage or behavior gaps are discovered, implement or update automated tests (unit, integration, E2E) so that all recommendations and minimum coverage thresholds (≥95 % `internal/app`, ≥85 % project-wide) are satisfied, recording evidence from `just test-coverage` (or equivalent) in this story file.

2.8.3: Summarize verification results, implemented changes, and remaining follow-ups directly within `docs/stories/2.8.review-epic-2-testing-alignment.md` under a Findings & Coverage Evidence section, referencing source files and commits.

2.8.4: Update `internal/adapters/spi/schema/README.md` and `internal/app/schema/README.md` so they document the Epic 2 testing expectations, remediation reminders, and ownership details surfaced by this effort.

2.8.5: Capture QA leadership (Quinn) approval or outstanding blockers in the QA Results section of this story file after test remediation completes.

## Tasks / Subtasks

- [ ] Task 1 (AC: 2.8.1): Gather Epic 2 testing expectations
  - [ ] Compile recommended tests and quality gates from Epic 2 story files (`docs/stories/2.1`–`2.7`) and related QA artifacts (`docs/qa/gates`, `docs/qa/assessments`).
  - [ ] Extract explicit scenarios, coverage targets, and tooling requirements to build the verification checklist.
- [ ] Task 2 (AC: 2.8.1): Verify existing automated tests
  - [ ] Review current unit, integration, and E2E tests in `internal/app/schema`, `internal/domain`, `internal/adapters/spi/schema`, `tests/integration`, and other relevant packages.
  - [ ] Map implemented tests back to each recommendation, noting confirmed coverage and any gaps directly in this story file under Findings & Coverage Evidence.
- [ ] Task 3 (AC: 2.8.2): Implement missing or insufficient tests
  - [ ] Add or update automated tests to satisfy uncovered scenarios, following table-driven patterns, mocking strategies, and Result-pattern expectations referenced in Epic 2 materials.
  - [ ] Ensure co-location of new tests with implementation packages and adhere to linting/formatting standards.
- [ ] Task 4 (AC: 2.8.2 & 2.8.3): Validate coverage and document findings
  - [ ] Run `just test-coverage` (or equivalent) to confirm ≥95 % coverage for `internal/app` and ≥85 % overall; capture command output and summarize results in the Findings & Coverage Evidence section of this file.
  - [ ] Detail each remediation action, linking to updated source files/tests and citing which recommendation it fulfills.
- [ ] Task 5 (AC: 2.8.4): Update schema module documentation
  - [ ] Update or create README guidance in `internal/adapters/spi/schema/README.md` and `internal/app/schema/README.md` to reflect new or clarified testing expectations discovered during remediation.【architecture/source-tree.md#source-tree】
- [ ] Task 6 (AC: 2.8.5): Capture QA leadership sign-off
  - [ ] Share the updated Findings & Coverage Evidence and supporting commits with QA lead (Quinn).
  - [ ] Record confirmation or outstanding blockers, including follow-up actions and dates, in the QA Results section of this story file.
- [ ] Task 7: Enforce linting and formatting workflow
  - [ ] Run `golangci-lint fmt`
  - [ ] Run `golangci-lint run --fix`, rectifying warnings without `//nolint` unless unavoidable
  - [ ] After each fix, rerun `golangci-lint fmt` and execute tests to ensure they pass
- [ ] Task 8: Pre-commit and commit readiness
  - [ ] Execute `pre-commit run` to confirm hooks pass
  - [ ] Stage updates and commit with a full conventional commit message summarizing Epic 2 testing robustness improvements

## Dev Notes

### Previous Story Insights

- Story 2.5 is Approved, so the audit should verify that SchemaRegistry implementation work and associated tests align with its acceptance criteria and planned coverage expectations.【docs/stories/2.5.implement-basic-schema-registry-service.md#status】
- Story 2.6 is Approved, requiring the audit to confirm inheritance resolution coverage—especially cycle detection scenarios—meets the story’s quality bar.【docs/stories/2.6.implement-inheritance-resolution.md#status】
- Story 2.7 is Approved with explicit requirements for SchemaValidator tests across PropertySpec variants and context cancellation handling, providing key audit checkpoints for validator coverage.【docs/stories/2.7.implement-schema-validator-service.md#acceptance-criteria】

### Testing Strategy Requirements

- Coverage goals require ≥95 % for `internal/app` and ≥85 % overall, forming the baseline for Epic 2 audit compliance.【architecture/testing-strategy.md#testing-philosophy】
- Test planning must emphasize unit (70 %), integration (25 %), and E2E (5 %) distribution, ensuring Epic 2 artifacts align with the mandated test pyramid.【architecture/testing-strategy.md#testing-philosophy】
- Mocking strategy mandates in-memory mocks sourced from `tests/utils` plus table-driven tests for all public methods, which the audit must verify within Epic 2 implementations.【architecture/testing-strategy.md#unit-tests】
- QA must confirm CLI and template integration flows for higher-level tests, as outlined for integration coverage expectations.【architecture/testing-strategy.md#integration-tests】

### Coding Standards & Constraints

- Coding standards require Result-pattern usage and context-aware functions, both of which should appear in Epic 2 test fixtures and be validated during the audit.【architecture/coding-standards.md#core-standards】
- Testing rules mandate table-driven tests co-located with implementation and coverage of success, validation failure, and cancellation paths—explicit checks for the audit.【architecture/coding-standards.md#testing】

### QA Artifact Locations

- QA gate decisions for Epic 2 currently exist up to Story 2.4 (e.g., `docs/qa/gates/2.4-implement-schema-engine-port-and-adapter.yml`), providing precedent for required documentation format and content.【docs/qa/gates/2.4-implement-schema-engine-port-and-adapter.yml】
- QA assessments (risk/NFR/trace) for Epic 2 stories are stored under `docs/qa/assessments/` and must be cross-checked for freshness during the audit (e.g., `docs/qa/assessments/2.1-nfr-20251020.md`).【docs/qa/assessments/2.1-nfr-20251020.md】

### File Locations

- Story and QA artifacts live within `docs/stories/` and `docs/qa/`, while schema-related implementation and test files reside under `internal/app/schema/` and `internal/adapters/spi/schema/`; README deliverables created in Task 7 capture testing expectations for those directories per the source tree guide.【docs/architecture/source-tree.md#source-tree】

### Deliverable Expectations

- Findings should link to coverage artifacts generated via `just test-coverage` or `just test-artifacts` to substantiate compliance claims and be summarized in this story file.【architecture/testing-strategy.md#continuous-testing】
- Remediation actions must align with QA leadership governance, matching gate formats established by existing Epic 2 QA files when referencing approvals.【docs/qa/gates/2.2.implement-schema-domain-model.yml】

### Testing

- Ensure completed work confirms adherence to coverage thresholds (≥95 % `internal/app`, ≥85 % project) and record coverage evidence within the Findings & Coverage Evidence section.【architecture/testing-strategy.md#testing-philosophy】
- Validate that table-driven unit tests, integration flows, and CLI smoke tests align with prescribed distribution and mocking practices; document gaps and resolutions in the same section.【architecture/testing-strategy.md#unit-tests】
- When validating AC 2.8.4, ensure the QA Results section includes Quinn’s approval (or blockers with next review date) and that references to updated tests/readmes are listed.
- Confirm that new or updated tests follow co-location rules and exercise cancellation, error, and success paths per coding standards.【architecture/coding-standards.md#testing】

## Findings & Coverage Evidence

_TBD_

## Change Log

| Date       | Version | Description                                            | Author |
| ---------- | ------- | ------------------------------------------------------ | ------ |
| 2025-10-21 | 1.0     | Initial story draft for Epic 2 testing alignment audit | sm     |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

_TBD_

### File List

_TBD_

## QA Results

_TBD_
