# Story 3.3: Enhance FileSystem Port for Vault Scanning

## Status

Draft

## Story

As a developer, I want to enhance the FileSystemPort to support vault scanning operations, so that vault indexing can discover markdown files through the proper architectural interface.

## Acceptance Criteria

- 3.3.1: FileSystemPort interface includes Walk method with WalkFunc signature per `docs/architecture/components.md#filesystemport`.
- 3.3.2: LocalFileSystemAdapter implements Walk using Go stdlib `filepath.Walk` functionality.
- 3.3.3: Vault scanning logic filters for `.md` files and ignores `.lithos` cache directory.
- 3.3.4: Scanner returns slice of absolute paths and handles filesystem errors gracefully.

## Tasks / Subtasks

- [ ] Task 1 (AC: 3.3.1): Enhance `FileSystemPort` Interface
  - [ ] Add `Walk(root string, fn WalkFunc) error` to the `FileSystemPort` interface in `internal/ports/spi/filesystem.go`. [Source: docs/architecture/components.md#filesystemport]
- [ ] Task 2 (AC: 3.3.2, 3.3.3, 3.3.4): Implement `Walk` in `LocalFileSystemAdapter`
  - [ ] Implement the `Walk` method in `internal/adapters/spi/filesystem/local_filesystem_adapter.go`.
  - [ ] Use `filepath.Walk` to traverse the directory tree.
  - [ ] The walk function should filter for files with the `.md` extension.
  - [ ] The walk function should ignore the `.lithos` directory.
  - [ ] The walk function should collect the absolute paths of the matching files.
  - [ ] The method should return a slice of absolute paths and handle any errors that occur during the walk.
- [ ] Task 3: Add Unit Tests
  - [ ] Add unit tests for the `Walk` method in `internal/adapters/spi/filesystem/local_filesystem_adapter_test.go`.
  - [ ] Test that the walk correctly identifies markdown files.
  - [ ] Test that the walk correctly ignores the `.lithos` directory.
  - [ ] Test that the walk correctly handles errors.

## Dev Notes

### Data Models
- `File` uses absolute paths as primary keys. The `Walk` method will be responsible for generating these paths. [Source: docs/architecture/data-models.md#file]

### Component Specifications
- The `Walk` method will be consumed by the `VaultIndexer` to get a list of files to index. [Source: docs/architecture/components.md#vaultindexer]
- The `LocalFileSystemAdapter` implements the `FileSystemPort`. [Source: docs/architecture/components.md#localfilesystemadapter]

### File Locations
- `FileSystemPort` is defined in `internal/ports/spi/filesystem.go`.
- `LocalFileSystemAdapter` is implemented in `internal/adapters/spi/filesystem/local_filesystem_adapter.go`.
- Tests for the adapter are in `internal/adapters/spi/filesystem/local_filesystem_adapter_test.go`.
[Source: docs/architecture/source-tree.md#source-tree]

### Testing Requirements
- Unit tests should be table-driven and cover success, filtering, and error cases. [Source: docs/architecture/testing-strategy.md#unit-tests]
- Use a temporary directory for testing to avoid interacting with the actual filesystem. [Source: docs/architecture/testing-strategy.md#integration-tests]

### Technical Constraints
- The `Walk` method must be efficient and handle large vaults with many files.
- Error handling should be robust and provide clear messages. [Source: docs/architecture/coding-standards.md#error-handling]

## Change Log

| Date       | Version | Description                                    | Author |
| ---------- | ------- | ---------------------------------------------- | ------ |
| 2025-10-22 | 1.0     | Initial story draft for enhancing FileSystemPort | sm     |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

_TBD_

### File List

_TBD_

## QA Results

_TBD_
