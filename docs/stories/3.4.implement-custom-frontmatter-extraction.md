# Story 3.4: Implement Custom Frontmatter Extraction

## Status

Draft

## Story

As a developer, I want to implement custom frontmatter extraction using the specified technology stack, so that I have control over parsing behavior and minimize dependencies.

## Acceptance Criteria

- 3.4.1: `internal/app/indexing/` contains custom frontmatter extraction logic using delimiter detection per `docs/architecture/tech-stack.md#yaml-parsing`.
- 3.4.2: Implementation uses `github.com/goccy/go-yaml` for YAML parsing after delimiter extraction.
- 3.4.3: Parser returns frontmatter as `map[string]interface{}` and creates Frontmatter domain model per `docs/architecture/data-models.md#frontmatter`.
- 3.4.4: Graceful handling of files with no frontmatter, invalid YAML, or unsupported delimiter variants (only `---` supported).

## Tasks / Subtasks

- [ ] Task 1 (AC: 3.4.1, 3.4.2): Implement Frontmatter Extraction Logic
  - [ ] Create a new file `internal/app/indexing/frontmatter.go`.
  - [ ] Implement a function `ExtractFrontmatter(content []byte) (map[string]interface{}, error)`.
  - [ ] The function should scan the file content for `---` delimiters at the beginning of the file.
  - [ ] If delimiters are found, extract the content between them.
  - [ ] Use `github.com/goccy/go-yaml` to parse the extracted content.
- [ ] Task 2 (AC: 3.4.3): Create Frontmatter Domain Model
  - [ ] In the `ExtractFrontmatter` function, after parsing the YAML, create and return a `domain.Frontmatter` model.
- [ ] Task 3 (AC: 3.4.4): Implement Graceful Error Handling
  - [ ] If no frontmatter is found, return an empty map and no error.
  - [ ] If the YAML is invalid, return a wrapped error.
  - [ ] If unsupported delimiters are used, treat it as if there is no frontmatter.
- [ ] Task 4: Add Unit Tests
  - [ ] Add unit tests for the `ExtractFrontmatter` function in `internal/app/indexing/frontmatter_test.go`.
  - [ ] Test with valid frontmatter.
  - [ ] Test with no frontmatter.
  - [ ] Test with invalid YAML.
  - [ ] Test with unsupported delimiters.
- [ ] Task 5: Full method and function decomposition into private srp function while ensuring a logical file organization.
- [ ] Task 6: Enforce linting and formatting workflow
  - [ ] Run `golangci-lint fmt`
  - [ ] Run `golangci-lint run --fix`, rectifying warnings without `//nolint` unless unavoidable
  - [ ] After each fix, rerun `golangci-lint fmt` and execute tests to ensure they pass
- [ ] Task 7: Pre-commit and commit readiness
  - [ ] Execute `pre-commit run` to confirm hooks pass
  - [ ] Stage updates and commit with a fully descriptive conventional commit message

## Dev Notes

### Data Models
- The `Frontmatter` model is defined in `internal/domain/frontmatter.go`. It has a `FileClass` and a `Fields` map. [Source: docs/architecture/data-models.md#frontmatter]

### Component Specifications
- The `VaultIndexer` will use the `ExtractFrontmatter` function to parse frontmatter from files during indexing. [Source: docs/architecture/components.md#vaultindexer]
- **Dependency Note:** This story depends on Story 3.3 (filesystem scanning) being complete, as the VaultIndexer requires file paths from the `Walk` method to identify files for frontmatter extraction.

### File Locations
- The frontmatter extraction logic should be in `internal/app/indexing/frontmatter.go`. [Source: docs/architecture/source-tree.md#source-tree]
- Tests should be in `internal/app/indexing/frontmatter_test.go`. [Source: docs/architecture/testing-strategy.md#unit-tests]

### Testing Requirements
- Unit tests should be table-driven and cover all scenarios, including valid, invalid, and missing frontmatter. [Source: docs/architecture/testing-strategy.md#unit-tests]

### Technical Constraints
- The implementation must use `github.com/goccy/go-yaml` for YAML parsing. [Source: docs/architecture/tech-stack.md#yaml-parsing]
- Only `---` delimiters are supported. [Source: docs/architecture/tech-stack.md#frontmatter-extraction]

## Change Log

| Date       | Version | Description                                    | Author |
| ---------- | ------- | ---------------------------------------------- | ------ |
| 2025-10-22 | 1.0     | Initial story draft for frontmatter extraction | sm     |
| 2025-10-23 | 1.1     | Added explicit dependency note on Story 3.3    | sm     |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

_TBD_

### File List

_TBD_

## QA Results

_TBD_
