# Story 1.1: Verify Development Tooling and Project Structure

## Status

Draft

## Story

**As a** developer,
**I want** to verify that all development tooling configuration files and project structure exist,
**so that** the project has consistent linting, formatting, security scanning, and proper hexagonal architecture from the start.

## Acceptance Criteria

**Development Tooling:**

- 1.1.1: Verify `.golangci.toml` exists with correct configuration:
  - Uses golangci-lint v2 format
  - Enables all linters from architecture tech stack
  - Line length set to 100 characters
  - Timeout set to 5m

- 1.1.2: Verify `.gitignore` exists with entries for:
  - Go build artifacts (_.exe, _.dll, _.so, _.dylib, \*.test)
  - IDE files (.vscode/, .idea/)
  - Lithos-specific (.lithos/, testdata/vault-copies/)
  - OS files (.DS_Store, Thumbs.db)

- 1.1.3: Verify `.gitattributes` exists with:
  - Line ending normalization (\* text=auto eol=lf)
  - Binary file markers for images, archives
  - Git LFS configuration for large files

- 1.1.4: Verify `.gitleaks.toml` exists with:
  - useDefault = true
  - AWS, GitHub, Slack secret detection rules
  - Allowlist for test files and documentation

- 1.1.5: Verify `.pre-commit-config.yaml` exists with hooks:
  - pre-commit-hooks (check-json, check-yaml, detect-private-key, etc.)
  - gitleaks (v8.28.0)
  - go-fmt, go-imports, go-vet-mod
  - golangci-lint (v2.4.0)

- 1.1.6: Run `pre-commit install` to activate hooks

- 1.1.7: Run `pre-commit run --all-files` and verify all hooks pass

**Project Structure:**

- 1.1.8: Verify `go.mod` exists with:
  - Module: `github.com/JackMatanky/lithos`
  - Go version: 1.23+ (required for generics)

- 1.1.9: Verify hexagonal architecture directories exist:
  - `internal/domain/` (core business logic)
  - `internal/app/` (core business services)
  - `internal/ports/api/` (primary/driving port interfaces)
  - `internal/ports/spi/` (secondary/driven port interfaces)
  - `internal/adapters/api/` (primary/driving adapters)
  - `internal/adapters/spi/` (secondary/driven adapters)
  - `internal/shared/` (cross-cutting concerns)

- 1.1.10: Verify test directories exist:
  - `tests/integration/`
  - `tests/e2e/`
  - `tests/utils/` (contains mocks.go)

- 1.1.11: Verify testdata structure exists:
  - `testdata/golden/` (expected outputs)
  - `testdata/schema/valid/` (valid schemas)
  - `testdata/schema/invalid/` (invalid schemas for testing)
  - `testdata/schema/properties/` (property bank files)
  - `testdata/notes/` (sample notes)
  - `testdata/templates/` (sample templates)

- 1.1.12: Verify CLI entrypoint exists at `cmd/lithos/main.go`

- 1.1.13: Verify `README.md` exists with project overview

- 1.1.14: Run `go mod tidy` to ensure dependencies are clean

- 1.1.15: Document verification results in commit message

- 1.1.16: Committed with message: `chore: verify development tooling and project structure`

## Tasks / Subtasks

- [ ] Task 1: Verify development tooling configuration files (AC: 1.1.1-1.1.5)
  - [ ] Check `.golangci.toml` configuration
    - [ ] Verify v2 format
    - [ ] Verify all linters enabled from tech stack
    - [ ] Verify line length set to 100 characters
    - [ ] Verify timeout set to 5m
  - [ ] Check `.gitignore` entries
    - [ ] Verify Go build artifacts excluded
    - [ ] Verify IDE files excluded
    - [ ] Verify Lithos-specific exclusions
    - [ ] Verify OS files excluded
  - [ ] Check `.gitattributes` configuration
    - [ ] Verify line ending normalization
    - [ ] Verify binary file markers
    - [ ] Verify Git LFS configuration
  - [ ] Check `.gitleaks.toml` secret detection rules
    - [ ] Verify useDefault = true
    - [ ] Verify AWS/GitHub/Slack rules
    - [ ] Verify test file allowlist
  - [ ] Check `.pre-commit-config.yaml` hooks
    - [ ] Verify pre-commit-hooks included
    - [ ] Verify gitleaks v8.28.0
    - [ ] Verify go-fmt, go-imports, go-vet-mod
    - [ ] Verify golangci-lint v2.4.0
  - [ ] Document any missing or incorrect configurations
  - [ ] Linting checkpoint:
    - [ ] All configuration files verified
    - [ ] Document findings
    - [ ] No critical misconfigurations

- [ ] Task 2: Activate and test pre-commit hooks (AC: 1.1.6-1.1.7)
  - [ ] Run `pre-commit install`
    - [ ] Verify installation successful
    - [ ] Verify hooks registered in `.git/hooks/pre-commit`
  - [ ] Run `pre-commit run --all-files`
    - [ ] Capture output
    - [ ] Identify any failures
  - [ ] Fix any hook failures
    - [ ] Address formatting issues
    - [ ] Address linting warnings
    - [ ] Address security warnings
  - [ ] Verify all hooks pass
    - [ ] Re-run `pre-commit run --all-files`
    - [ ] Confirm zero failures
  - [ ] Linting checkpoint:
    - [ ] All pre-commit hooks pass
    - [ ] No secrets detected
    - [ ] All files formatted correctly

- [ ] Task 3: Verify Go module and hexagonal architecture (AC: 1.1.8-1.1.9)
  - [ ] Check `go.mod` module name and Go version
    - [ ] Verify module name: `github.com/JackMatanky/lithos`
    - [ ] Verify Go version: 1.23+
    - [ ] Verify no broken dependencies
  - [ ] Verify all hexagonal architecture directories exist
    - [ ] Check `internal/domain/` exists
    - [ ] Check `internal/app/` exists
    - [ ] Check `internal/ports/api/` exists
    - [ ] Check `internal/ports/spi/` exists
    - [ ] Check `internal/adapters/api/` exists
    - [ ] Check `internal/adapters/spi/` exists
    - [ ] Check `internal/shared/` exists
  - [ ] Create missing directories if needed
    - [ ] Create with appropriate permissions
    - [ ] Document directory purpose
  - [ ] Document directory structure
    - [ ] Verify alignment with architecture v0.6.8
    - [ ] Document any deviations
  - [ ] Linting checkpoint:
    - [ ] All required directories exist
    - [ ] Directory structure verified
    - [ ] Architecture compliance confirmed

- [ ] Task 4: Verify test infrastructure (AC: 1.1.10-1.1.11)
  - [ ] Check test directories exist
    - [ ] Verify `tests/integration/` exists
    - [ ] Verify `tests/e2e/` exists
    - [ ] Verify `tests/utils/` exists
  - [ ] Check testdata structure exists
    - [ ] Verify `testdata/golden/` exists
    - [ ] Verify `testdata/schema/valid/` exists
    - [ ] Verify `testdata/schema/invalid/` exists
    - [ ] Verify `testdata/schema/properties/` exists
    - [ ] Verify `testdata/notes/` exists
    - [ ] Verify `testdata/templates/` exists
  - [ ] Create missing directories if needed
    - [ ] Create with appropriate permissions
    - [ ] Document directory purpose
  - [ ] Document test organization
    - [ ] Verify alignment with testing strategy
    - [ ] Document test data layout
  - [ ] Linting checkpoint:
    - [ ] All test directories exist
    - [ ] Testdata structure complete
    - [ ] Test organization documented

- [ ] Task 5: Verify entrypoints and documentation (AC: 1.1.12-1.1.13)
  - [ ] Check `cmd/lithos/main.go` exists
    - [ ] Verify file exists at correct path
    - [ ] Verify basic structure (main function, imports)
  - [ ] Check `README.md` exists
    - [ ] Verify file exists at project root
    - [ ] Verify contains project overview
  - [ ] Document any missing files
    - [ ] List missing files
    - [ ] Note importance of each
  - [ ] Linting checkpoint:
    - [ ] All entrypoints verified
    - [ ] Documentation present
    - [ ] Project structure complete

- [ ] Task 6: Clean dependencies and commit (AC: 1.1.14-1.1.16)
  - [ ] Run `go mod tidy`
    - [ ] Remove unused dependencies
    - [ ] Add missing dependencies
    - [ ] Verify go.mod and go.sum clean
  - [ ] Review verification results
    - [ ] Summarize all findings
    - [ ] Confirm all requirements met
    - [ ] Document any exceptions
  - [ ] Commit with proper message
    - [ ] Stage all changes
    - [ ] Use message: `chore: verify development tooling and project structure`
    - [ ] Include summary of verification in commit body
  - [ ] Linting checkpoint:
    - [ ] Dependencies clean
    - [ ] All verification complete
    - [ ] Commit message follows conventions

## Dev Notes

### Source Tree Structure

From `docs/architecture/source-tree.md`:

**Hexagonal Architecture Directories:**
- `internal/domain/` - Core models (NoteID, Frontmatter, Note, Schema, Property, Template, Config)
- `internal/app/` - Domain services & orchestrators (template, indexing, schema, query, command)
- `internal/ports/api/` - CLIPort and related contracts
- `internal/ports/spi/` - CacheWriter, CacheReader, VaultReader, VaultWriter, SchemaPort, TemplatePort, etc.
- `internal/adapters/api/` - Cobra CLI (TUI/LSP post-MVP)
- `internal/adapters/spi/` - Cache, config, interactive, schema, template adapters
- `internal/shared/` - Cross-cutting helpers (logger, errors, registry, utilities)

**Test Infrastructure:**
- `tests/integration/` - Integration tests requiring full vault fixtures
- `tests/e2e/` - End-to-end tests
- `tests/utils/` - Test utilities and mocks
- `testdata/` - Golden vault for automated tests

**Data Directories:**
- `templates/` - Default template pack shipped with CLI
- `schemas/` - User-defined schemas + property banks
- `.lithos/` - Runtime cache (ignored in version control)

### Development Tooling

From `docs/architecture/tech-stack.md` and `docs/architecture/coding-standards.md`:

**Required Tools:**
- Go 1.23+ (minimum for generics, latest stable: 1.25.2)
- golangci-lint v2.4.0 (CI enforcement)
- gitleaks v8.28.0 (secret detection)
- pre-commit hooks (formatting, linting, security)

**Coding Standards:**
- Line length: 100 characters (enforced in `.golangci.toml`)
- Linting timeout: 5 minutes
- All linters from tech stack MUST be enabled
- Pre-commit hooks MUST pass before commit
- `just verify` command for local full check suite

**Go Module:**
- Module name: `github.com/JackMatanky/lithos`
- Go version: 1.23+ minimum
- Versioning strategy: Pin to specific minor versions for dependencies

### Testing

From `docs/architecture/testing-strategy.md`:

**Test Organization:**
- Unit tests live beside code (`*_test.go`)
- Integration tests in `tests/integration/`
- End-to-end tests in `tests/e2e/`
- Golden files in `testdata/` mirroring vault layout
- Mocks in `tests/utils/mocks.go`

**Test Data Structure:**
- `testdata/golden/` - Expected outputs for verification
- `testdata/schema/valid/` - Valid schema files for testing
- `testdata/schema/invalid/` - Invalid schemas for error testing
- `testdata/schema/properties/` - Property bank test files
- `testdata/notes/` - Sample note files
- `testdata/templates/` - Sample template files

### Quality Gates

From `docs/architecture/coding-standards.md`:

**Enforcement Points:**
- **On Save:** `golangci-lint run` in editors
- **On Commit:** `golangci-lint run` and `gitleaks detect` (pre-commit)
- **On PR:** `go test ./...`, `golangci-lint run`, `gitleaks detect` (CI)
- **Manual:** `just verify` for full local check suite

**Critical Requirements:**
- All pre-commit hooks MUST pass
- No linting errors or warnings
- No secrets detected by gitleaks
- Go modules clean and tidy

### Verification Guidelines

**Verification Strategy:**

Since this is a verification-only story (no code implementation), the focus is on ensuring project setup meets architecture requirements:

**Configuration File Verification:**
- Check existence and correctness of all tooling config files
- Verify configuration values match architecture specifications
- Ensure all required linters/hooks are enabled
- Document any deviations from standards

**Directory Structure Verification:**
- Verify hexagonal architecture directory tree exists
- Check test infrastructure directories present
- Confirm testdata structure matches testing strategy
- Create missing directories as needed

**Pre-commit Hook Verification:**
- Install hooks and verify registration
- Run hooks against all files
- Fix any issues identified by hooks
- Ensure all hooks pass before story completion

**Go Module Verification:**
- Check module name correct
- Verify Go version meets minimum requirement (1.23+)
- Run `go mod tidy` to clean dependencies
- Ensure no broken or unused dependencies

**Documentation Verification:**
- Verify README exists with project overview
- Check entrypoint exists at `cmd/lithos/main.go`
- Ensure documentation references match architecture

**When to Create vs. Verify:**
- **Verify Only:** Configuration files, existing directories
- **Create if Missing:** Test directories, testdata subdirectories
- **Document Issues:** Any missing or incorrect configurations

**Naming Standards:**
- Configuration files: lowercase with dots (`.golangci.toml`)
- Directories: lowercase with hyphens or underscores
- Go files: lowercase with underscores (`main.go`, `mocks.go`)

**Documentation Requirements:**
- Document all verification results
- Note any configurations created or fixed
- List any deviations from architecture specifications
- Include summary in commit message

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-28 | 1.0 | Story created from Epic 1 requirements | Bob (Scrum Master) |
| 2025-10-28 | 1.1 | Enhanced with detailed verification framework, linting checkpoints | QA Specialist |

## Dev Agent Record

### Agent Model Used

_To be completed by dev agent during implementation_

### Debug Log References

_To be completed by dev agent during implementation_

### Completion Notes List

_To be completed by dev agent during implementation_

### File List

_To be completed by dev agent during implementation_

## QA Results

_To be completed by QA agent after implementation_
