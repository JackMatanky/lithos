# Story 1.9: Implement the `new` Command and Template Reading

## Status

Draft

## Story

As a developer, I want to add a `new` command that reads a template file using the `FileSystemPort`, so that the command is wired into the architecture.

## Acceptance Criteria

- 1.9.1: A `new` subcommand is added to the Cobra adapter.
- 1.9.2: The command accepts a `<template-path>` argument.
- 1.9.3: The command's `RunE` function is injected with the `FileSystemPort`.
- 1.9.4: The command successfully uses the port to read the specified template file into memory.
- 1.9.5: A clear error is shown if the file does not exist, and the error originates from the adapter, not the command logic itself.

## Tasks / Subtasks

- [ ] Task 1: Add `new` subcommand to CobraCLIAdapter (AC: 1.9.1, 1.9.2)
  - [ ] Modify internal/adapters/api/cli/cobra_adapter.go to add new command
  - [ ] Implement command with <template-path> argument
- [ ] Task 2: Inject FileSystemPort into command (AC: 1.9.3)
  - [ ] Update command constructor to accept FileSystemPort
  - [ ] Wire port injection in main.go or adapter setup
- [ ] Task 3: Implement template reading logic (AC: 1.9.4, 1.9.5)
  - [ ] Add RunE function that calls FileSystemPort.ReadFile
  - [ ] Handle file not found errors properly
  - [ ] Log success or error appropriately
- [ ] Task 4: Add unit tests for new command
  - [ ] Create tests in internal/adapters/api/cli/
  - [ ] Test successful file reading
  - [ ] Test error handling for missing files
- [ ] Task 5: Run tests and verify implementation
  - [ ] Execute go test ./internal/adapters/api/cli/
  - [ ] Verify all tests pass
  - [ ] Run golangci-lint to ensure code standards
- [ ] Task 6: Pass pre-commit hooks and commit changes
  - [ ] Run pre-commit hooks
  - [ ] Commit with conventional commit message

## Dev Notes

### Previous Story Insights

Story 1.8 integrated Cobra and created the CLI adapter structure. This story builds on that by adding the first command to the adapter, following the established pattern of injecting ports into command RunE functions.

### FileSystemPort Specifications

[Source: docs/architecture/components.md#filesystemport]

**Responsibility:** Provide safe file read/write/walk operations so domain services can interact with the vault without importing `os`.

**Key Interfaces:**

- `ReadFile(path string) ([]byte, error)`
- `WriteFileAtomic(path string, data []byte) error`
- `Walk(root string, fn WalkFunc) error`

**Dependencies:** Implemented by LocalFileSystemAdapter.

**Technology Stack:** Go `os`, `io`, and atomic write helpers (temp file + rename); honors config-defined vault roots.

### File Locations

[Source: docs/architecture/source-tree.md]

- CLI Adapter: internal/adapters/api/cli/cobra_adapter.go
- Main entry: cmd/lithos/main.go

### Technology Stack

[Source: docs/architecture/tech-stack.md]

- CLI Framework: github.com/spf13/cobra v1.9.1
- Go version: 1.23+ minimum

### Testing Requirements

[Source: docs/architecture/testing-strategy.md]

- Unit tests for adapter in internal/adapters/api/cli/
- Integration tests for CLI command flows
- Test coverage â‰¥85% for adapter package

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-01-12 | 1.0     | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

[To be filled by dev agent]

### Debug Log References

[To be filled by dev agent]

### Completion Notes List

[To be filled by dev agent]

### File List

[To be filled by dev agent]

## QA Results

[To be filled by QA agent]
