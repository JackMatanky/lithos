# Story 1.8: Integrate Cobra and the CLI Adapter

## Status

Draft

## Story

As a developer, I want to integrate the Cobra framework into the `cmd/lithos/main.go` entrypoint via a CLI adapter, so that the application has a robust command structure.

## Acceptance Criteria

- 1.8.1: `github.com/spf13/cobra` is added to `go.mod`.
- 1.8.2: A `CobraCLIAdapter` is created in `internal/adapters/api/cli/`.
- 1.8.3: The `main.go` file executes the Cobra adapter.
- 1.8.4: A root `lithos` command and a `version` subcommand are created and functional.
- 1.8.5: Running `lithos version` prints the version string.

## Tasks / Subtasks

- [ ] Task 1: Add Cobra dependency to go.mod (AC: 1.8.1)
  - [ ] Run `go get github.com/spf13/cobra@v1.9.1`
  - [ ] Verify dependency is added correctly
- [ ] Task 2: Create CobraCLIAdapter in internal/adapters/api/cli/ (AC: 1.8.2)
  - [ ] Create internal/adapters/api/cli/ directory
  - [ ] Create cobra_adapter.go file with CobraCLIAdapter struct
  - [ ] Implement Execute method that sets up root command and version subcommand
  - [ ] Implement registerCommands method to set up command tree
- [ ] Task 3: Update main.go to execute the adapter (AC: 1.8.3)
  - [ ] Modify cmd/lithos/main.go to instantiate and execute CobraCLIAdapter
  - [ ] Ensure proper error handling and exit codes
- [ ] Task 4: Test the CLI commands (AC: 1.8.4, 1.8.5)
  - [ ] Build the application
  - [ ] Test `lithos --help` shows root command
  - [ ] Test `lithos version` prints version string
- [ ] Task 5: Run tests and verify implementation
  - [ ] Execute go test ./internal/adapters/api/cli/
  - [ ] Verify all tests pass
  - [ ] Run golangci-lint to ensure code standards compliance
- [ ] Task 6: Pass pre-commit hooks and commit changes
  - [ ] Run pre-commit hooks: golangci-lint run and gitleaks detect
  - [ ] Ensure all hooks pass without errors
  - [ ] Stage all changed files
  - [ ] Create conventional commit message following project standards
  - [ ] Commit all changes with the conventional commit message

## Dev Notes

### Previous Story Insights

Story 1.2 established the hexagonal architecture structure with internal/ directory layout. This story builds on that by adding the first API adapter in internal/adapters/api/cli/, following the established pattern.

### CobraCLIAdapter Specifications

[Source: docs/architecture/components.md#api-adapters]

**Responsibility:** Wire command-line interactions to `CLICommandPort`, translating flags/arguments into domain requests and presenting results.

**Key Interfaces:**

- `Execute(args []string) int`
- `registerCommands(root *cobra.Command)`

**Dependencies:** `CLICommandPort`, `ConfigPort`, `github.com/spf13/cobra`, Logger.

**Technology Stack:** Cobra command tree, `pflag` for flag parsing, structured output helpers (human-readable + JSON), zerolog instrumentation.

### File Locations

[Source: docs/architecture/source-tree.md]

- Adapter: internal/adapters/api/cli/cobra_adapter.go
- Main entry: cmd/lithos/main.go

### Technology Stack

[Source: docs/architecture/tech-stack.md]

- CLI Framework: github.com/spf13/cobra v1.9.1
- Go version: 1.23+ minimum

### Testing Requirements

[Source: docs/architecture/testing-strategy.md]

- Unit tests for adapter in internal/adapters/api/cli/
- Integration tests for CLI command flows
- Test coverage â‰¥85% for adapter package

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-01-12 | 1.0     | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

[To be filled by dev agent]

### Debug Log References

[To be filled by dev agent]

### Completion Notes List

[To be filled by dev agent]

### File List

[To be filled by dev agent]

## QA Results

[To be filled by QA agent]
