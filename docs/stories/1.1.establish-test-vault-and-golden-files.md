# Story 1.1: Establish Test Vault and Golden Files

## Status

Draft

## Story

**As a** QA specialist,
**I want** to create a foundational test data set,
**so that** all unit and integration tests can use a consistent and predictable set of "golden" files.

## Acceptance Criteria

1. A `testdata` directory is created in the repository.
2. The directory contains a minimal vault structure with sample templates, schemas, and notes.
3. A "golden" output file is created for a simple template to test against in later stories.

## Tasks / Subtasks

- [ ] Task 1: Create testdata directory structure (AC: 1)
  - [ ] Create `testdata/` directory in repository root
  - [ ] Create `testdata/vault/` subdirectory for test vault
  - [ ] Create `testdata/golden/` subdirectory for expected output files

- [ ] Task 2: Create minimal vault structure with sample data (AC: 2)
  - [ ] Create `testdata/vault/templates/` directory
  - [ ] Create simple template file `testdata/vault/templates/basic-note.md`
  - [ ] Create `testdata/vault/schemas/` directory
  - [ ] Create basic schema file `testdata/vault/schemas/note.json`
  - [ ] Create sample notes directory `testdata/vault/notes/`
  - [ ] Create sample note files with frontmatter in `testdata/vault/notes/`

- [ ] Task 3: Create golden output file for template testing (AC: 3)
  - [ ] Generate expected output by manually rendering basic template
  - [ ] Save expected output as `testdata/golden/basic-note-expected.md`
  - [ ] Document template input parameters used for golden file generation
  - [ ] Verify golden file structure matches expected template output format

- [ ] Task 4: Add comprehensive unit tests for test data structure
  - [ ] Test that testdata directory structure exists and is accessible
  - [ ] Test that sample vault files can be loaded successfully
  - [ ] Test that golden files can be read and compared during tests
  - [ ] Verify all sample data follows expected data model structures

## Dev Notes

### Architecture Context

This story establishes the testing foundation for the entire Lithos project. Based on the architecture documents, this test vault must support the core data models and follow the established directory structure.

**Source Tree Structure:** [Source: architecture/source-tree.md]
- `testdata/` directory is specified in the source tree as "Golden vault used in automated tests"
- The test vault structure should mirror the expected vault layout for consistency

**Data Models to Support:** [Source: architecture/data-models.md]
- **File Model**: Test files need Path, Basename, Folder, ModTime attributes
- **Frontmatter Model**: Test notes need FileClass and Fields for schema validation testing
- **Note Model**: Test data should provide complete File + Frontmatter compositions
- **Schema Model**: Test schemas need Name, Properties (optional Extends/Excludes for inheritance testing)
- **Template Model**: Test templates need FilePath, Name, Content for execution testing

**Tech Stack Requirements:** [Source: architecture/tech-stack.md]
- Use Go 1.23+ stdlib for file operations (`os`, `path/filepath`)
- Test files should be compatible with `github.com/goccy/go-yaml` for YAML parsing
- JSON schema files should use `encoding/json` stdlib
- Template content should use `text/template` syntax

### Testing Strategy Compliance

**Test Data Management:** [Source: architecture/testing-strategy.md]
- "Immutable vault fixtures under `testdata/vault/` containing templates, schemas, and notes"
- "Tests copy fixtures into temp directories before mutation"
- "Golden Files: Store rendered notes and cache JSON snapshots in `testdata/golden/`"
- Use `t.Cleanup` patterns for temporary directory management

**Directory Structure to Create:**
```
testdata/
├── vault/              # Test vault fixtures
│   ├── templates/      # Sample templates for testing
│   ├── schemas/        # Sample schemas for validation testing
│   └── notes/          # Sample notes with frontmatter
└── golden/             # Expected output files for comparison
    └── basic-note-expected.md
```

### Sample Data Requirements

**Basic Template Content:**
- Should use Go `text/template` syntax
- Include basic template functions: `now`, `toLower`, `toUpper` (per Epic 1.11)
- Support frontmatter variable substitution
- Be simple enough for golden file generation

**Basic Schema Structure:**
- JSON format with `name`, `properties` structure
- Include at least one string property with basic validation
- Support basic Property types: StringPropertySpec with enum/pattern constraints
- Follow Property model structure from data-models.md

**Sample Note Structure:**
- YAML frontmatter delimited by `---`
- Include `fileClass` field for schema reference
- Include sample user-defined fields
- Use `.md` extension following Obsidian conventions

### File Location Standards

**Testing Standards:** [Source: architecture/testing-strategy.md]
- Co-located `*_test.go` files near implementation
- Use `testdata/` for fixtures with helper copy utilities
- Integration tests under `tests/` when requiring full vault fixtures

**Coding Standards:** [Source: architecture/coding-standards.md]
- Unit tests MUST use table-driven cases for branches
- Tests MUST cover success, validation failure scenarios
- Golden files belong under `testdata/` mirroring vault layout
- Use `testing` stdlib package (Go 1.23+)

### Technical Constraints

- All paths must be cross-platform compatible (use `filepath.Join`)
- File permissions must be readable by test processes
- Sample data must not contain any secrets or sensitive information
- Template syntax must be valid for Go `text/template` engine
- Schema JSON must be valid and parseable by `encoding/json`
- YAML frontmatter must be valid and parseable by `goccy/go-yaml`

## Testing

### Test Requirements

Based on testing strategy from architecture documents:

**Unit Test Coverage:**
- Test data directory structure validation
- Sample file accessibility and format validation
- Golden file comparison utilities
- Cross-platform path handling

**Test Framework:** [Source: architecture/testing-strategy.md]
- Use Go stdlib `testing` package (Go 1.23+)
- Table-driven tests for multiple sample data scenarios
- Use `t.Cleanup` for temporary directory management

**Fixture Management:**
- Immutable fixtures in `testdata/vault/`
- Copy utilities to avoid mutating source fixtures
- Temporary directory patterns for test isolation

**File Validation Tests:**
- Verify template files contain valid Go template syntax
- Verify schema files contain valid JSON and proper structure
- Verify note files contain valid YAML frontmatter
- Verify golden files match expected output format

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-01-XX | 1.0 | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
