# Story 1.1: Establish Test Vault and Golden Files

## Status

Draft

## Story

**As a** QA specialist,
**I want** to create a foundational test data set,
**so that** all unit and integration tests can use a consistent and predictable set of "golden" files.

## Acceptance Criteria

- 1.1.1: A `testdata` directory is created in the repository.
- 1.1.2: The directory contains a minimal vault structure with sample templates, schemas, and notes.
- 1.1.3: A "golden" output file is created for a simple template to test against in Story 1.9.

## Tasks / Subtasks

- [ ] Create `testdata/` directory structure (AC: 1.1.1)
  - [ ] Create `testdata/vault/` subdirectory for vault fixtures
  - [ ] Create `testdata/golden/` subdirectory for golden output files
- [ ] Create minimal vault structure under `testdata/vault/` (AC: 1.1.2)
  - [ ] Create `testdata/vault/templates/` directory for sample templates
  - [ ] Create `testdata/vault/schemas/` directory for sample schemas
  - [ ] Create `testdata/vault/notes/` directory for sample notes
  - [ ] Create at least one simple template file (e.g., `daily-note.md`) with basic text/template syntax
  - [ ] Create at least one sample schema file in JSON format (per tech stack)
  - [ ] Create at least one sample note with YAML frontmatter (using `---` delimiters only)
- [ ] Create golden output file for template testing (AC: 1.1.3)
  - [ ] Manually render the simple template created above
  - [ ] Save the rendered output in `testdata/golden/`
  - [ ] Name the golden file to match the template name (e.g., `daily-note-golden.md`)
  - [ ] Create `testdata/README.md` documenting the test vault structure and golden file generation context

## Dev Notes

### Previous Story Insights

N/A - This is the first story in the project.

### Testing Standards

**Test Data Location:** [Source: architecture/source-tree.md#L32]
- All test fixtures MUST be placed under `testdata/` at the repository root
- This directory is recognized by Go tooling and excluded from compiled binaries

**Fixture Organization:** [Source: architecture/testing-strategy.md#L23-L27]
- **Immutable vault fixtures** belong under `testdata/vault/`
- Fixtures MUST contain templates, schemas, and notes that mirror real vault structure
- Tests MUST copy fixtures into temp directories before mutation (use `t.Cleanup` for removal)
- Do NOT mutate source fixtures directly

**Golden Files:** [Source: architecture/testing-strategy.md#L26-L27]
- Store rendered notes and cache JSON snapshots in `testdata/golden/`
- Verification MUST use byte comparison against golden files
- Golden files serve as expected outputs for template rendering tests in Story 1.9

**Test File Patterns:** [Source: architecture/coding-standards.md#L58-L62]
- Unit tests MUST live beside code under test as `*_test.go` files
- Integration tests MAY reside under `tests/` when requiring full vault fixtures
- Use table-driven test cases for covering multiple branches
- Tests MUST be callable via `just verify` command

### Data Models & File Formats

**Template Format:** [Source: architecture/tech-stack.md#L25]
- Templates use Go's `text/template` engine (stdlib)
- Templates are Markdown files with Go template syntax
- Epic 1 focuses on static templates with basic functions: `now`, `toLower`, `toUpper`

**Sample Template Complexity Guidance:**
- For this story's test vault, use basic static text with 1-2 template functions
- Example: `{{ now "2006-01-02" }}` for current date and `{{ "HELLO" | toLower }}` for string manipulation
- Keep it simple - these fixtures are for testing the template engine, not demonstrating complex templates

**Schema Format:** [Source: architecture/tech-stack.md#L23-L24]
- Schemas MUST be defined in **JSON format** (not YAML) for MVP
- Store schemas under `schemas/*.json` (though for test vault, use `testdata/vault/schemas/`)
- Use `encoding/json` stdlib for parsing (no external dependencies)

**Frontmatter Format:** [Source: architecture/tech-stack.md#L22]
- Frontmatter uses YAML format (Obsidian standard)
- Parsed using `github.com/goccy/go-yaml` library
- Frontmatter MUST use `---` delimiters ONLY (not `+++` or `;;;`)
- Custom frontmatter extraction implementation (~30 LOC core + ~50 LOC error handling)

**Note Structure:** [Source: architecture/testing-strategy.md#L25]
- Notes are Markdown files with optional YAML frontmatter
- Test notes should represent realistic vault content
- Include variety: notes with frontmatter, notes without, templates with different complexity levels

**Sample Note Content Guidance:**
- For the sample note with frontmatter, include 2-3 fields (e.g., `title`, `date`, `tags`)
- Keep content minimal but representative - a few paragraphs of markdown text
- Purpose is to test frontmatter parsing, not create comprehensive example content

### Project Structure Notes

**Directory Alignment:** [Source: architecture/source-tree.md#L32-L34]
- `testdata/` - Golden vault used in automated tests (repository root level)
- `.lithos/` - Runtime cache (ignored in version control, not needed for this story)
- `templates/` - Default template pack shipped with CLI (separate from test fixtures)
- `schemas/` - User-defined schemas + property banks (separate from test fixtures)

**Key Distinction:** The `testdata/` directory is specifically for test automation purposes and is separate from the production `templates/` and `schemas/` directories that will ship with the CLI.

### File System Standards

**File I/O:** [Source: architecture/tech-stack.md#L37-L38]
- Use stdlib `os` and `path/filepath` packages (no abstraction libraries like `afero`)
- Provides cross-platform path handling
- Aligns with "Standard Library First" principle

### Versioning Context

**Go Version:** [Source: architecture/tech-stack.md#L16]
- Minimum Go 1.23.0 required
- Latest stable is Go 1.25.2 (Oct 2025)
- Go 1.23+ provides testing improvements needed for Epic 1.1

### Testing

**Testing Framework:** [Source: architecture/tech-stack.md#L35]
- Use Go's stdlib `testing` package (no external test frameworks)
- Table-driven tests with subtests
- Test coverage reporting via `go test -cover`

**Test Requirements:** [Source: architecture/testing-strategy.md#L7-L8]
- Use `testdata/` for fixtures with helper copy utilities
- Avoid mutating source fixtures
- Tests MUST use `t.Cleanup` to remove temp directories

**Coverage Targets:** [Source: architecture/testing-strategy.md#L35]
- ≥85% coverage for `internal/app` packages
- ≥70% overall project coverage

**Note:** This story (1.1) creates the test infrastructure but does NOT write actual test code. The test files using these fixtures will be created in subsequent stories (particularly Story 1.9 for template rendering tests).

## Change Log

| Date       | Version | Description                                      | Author        |
| ---------- | ------- | ------------------------------------------------ | ------------- |
| 2025-10-18 | 1.0     | Initial story draft                              | Bob (SM Agent)|
| 2025-10-18 | 1.1     | Added sample content guidance and README clarity | Bob (SM Agent)|

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

## QA Results

_To be populated by QA Agent_
