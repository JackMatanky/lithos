# Story 1.2: Foundational Project Setup & Structure

## Status

Ready for Review

## Story

**As a** developer,
**I want** to initialize a Go module and create the hexagonal architecture package structure,
**so that** I have a clean, version-controlled, and architecturally-compliant foundation.

## Acceptance Criteria

1. The root directory contains a `go.mod` file and a comprehensive `.gitignore` file.
2. The `internal` directory is created with the core hexagonal structure: `app`, `domain`, `ports/api`, `ports/spi`, `adapters/api`, `adapters/spi`, and `shared`.
3. A root `README.md` documents prerequisites and project structure.
4. The main entrypoint is created at `cmd/lithos/main.go`.

## Tasks / Subtasks

- [x] Task 1: Initialize Go module and version control setup (AC: 1)
  - [x] Create `go.mod` file with module name `github.com/yourusername/lithos`
  - [x] Initialize git repository if not already present
  - [x] Create comprehensive `.gitignore` file for Go projects and Lithos-specific patterns
  - [x] Add `.lithos/cache/` to gitignore (runtime cache directory)
  - [x] Verify Go 1.23+ is being used per tech stack requirements

- [x] Task 2: Create hexagonal architecture directory structure (AC: 2)
  - [x] Create `internal/` directory for private application code
  - [x] Create `internal/domain/` directory for core business models
  - [x] Create `internal/app/` directory for domain services and orchestrators
  - [x] Create `internal/app/command/` subdirectory for command orchestration
  - [x] Create `internal/app/indexing/` subdirectory for indexing services
  - [x] Create `internal/app/query/` subdirectory for query services
  - [x] Create `internal/app/schema/` subdirectory for schema services
  - [x] Create `internal/app/template/` subdirectory for template services
  - [x] Create `internal/ports/api/` directory for driving port interfaces
  - [x] Create `internal/ports/spi/` directory for driven port interfaces
  - [x] Create `internal/adapters/api/` directory for driving adapters
  - [x] Create `internal/adapters/spi/` directory for driven adapters
  - [x] Create `internal/adapters/spi/cache/` subdirectory for cache adapters
  - [x] Create `internal/adapters/spi/config/` subdirectory for config adapters
  - [x] Create `internal/adapters/spi/filesystem/` subdirectory for filesystem adapters
  - [x] Create `internal/adapters/spi/interactive/` subdirectory for interactive adapters
  - [x] Create `internal/adapters/spi/schema/` subdirectory for schema adapters
  - [x] Create `internal/adapters/spi/template/` subdirectory for template adapters
  - [x] Create `internal/shared/` directory for cross-cutting concerns

- [x] Task 3: Create root README documentation (AC: 3)
  - [x] Create `README.md` file with project overview and purpose
  - [x] Document prerequisites (Go 1.23+, git)
  - [x] Document project structure and hexagonal architecture layout
  - [x] Include build and development instructions
  - [x] Document basic usage commands for future reference
  - [x] Add contribution guidelines and architecture principles

- [x] Task 4: Create main application entrypoint (AC: 4)
  - [x] Create `cmd/` directory for command entry points
  - [x] Create `cmd/lithos/` subdirectory for main application
  - [x] Create `cmd/lithos/main.go` with basic application entrypoint
  - [x] Add package documentation and basic structure
  - [x] Ensure main.go follows coding standards and project structure

- [x] Task 5: Add comprehensive unit tests for project structure
  - [x] Test that all required directories exist and are accessible
  - [x] Test that go.mod file is valid and contains correct module name
  - [x] Test that .gitignore contains all required patterns
  - [x] Test that main.go can be compiled without errors
  - [x] Verify project structure matches architecture document specifications

## Dev Notes

### Architecture Context

This story establishes the foundational Go project structure following hexagonal architecture principles. Based on the architecture documents, this setup must align with the defined tech stack and directory organization.

**Source Tree Structure:** [Source: architecture/source-tree.md]
- Root structure includes `cmd/lithos/main.go` as the main entrypoint
- `internal/` directory contains the complete hexagonal architecture organization
- `internal/domain/` for core models (File, Frontmatter, Note, Schema, Property)
- `internal/app/` with service subdirectories (command, indexing, query, schema, template)
- `internal/ports/` split into `api/` (driving) and `spi/` (driven) interfaces
- `internal/adapters/` with corresponding `api/` and `spi/` implementations
- `internal/shared/` for cross-cutting concerns (logger, errors, registry, utilities)
- Additional directories: `pkg/` (reserved), `templates/`, `schemas/`, `testdata/`, `.lithos/`, `docs/`

**Tech Stack Requirements:** [Source: architecture/tech-stack.md]
- Go 1.23+ minimum (supports iterators, improved errors.Join)
- Module name should follow Go conventions for eventual publishing
- Standard library first approach - minimize external dependencies initially
- `.gitignore` must exclude `.lithos/` runtime cache directory

**Hexagonal Architecture Principles:** [Source: architecture/components.md]
- Clear separation between domain core, ports, and adapters
- Domain services in `internal/app/` have no infrastructure dependencies
- Port interfaces in `internal/ports/` define contracts between layers
- Adapters in `internal/adapters/` implement port interfaces with external concerns
- Shared packages in `internal/shared/` provide cross-cutting utilities

### Project Structure Requirements

**Go Module Setup:**
- Module name should be `github.com/yourusername/lithos` (replace with actual username)
- Go version directive must specify 1.23+ per tech stack requirements
- No initial dependencies - start with stdlib only approach

**Directory Structure to Create:**
```
lithos/
├── cmd/
│   └── lithos/
│       └── main.go                 # Application entrypoint
├── internal/
│   ├── domain/                     # Core models (File, Frontmatter, Note, Schema, Property)
│   ├── app/                        # Domain services & orchestrators
│   │   ├── command/                # Command orchestration
│   │   ├── indexing/               # Vault indexing services
│   │   ├── query/                  # Query services
│   │   ├── schema/                 # Schema services
│   │   └── template/               # Template services
│   ├── ports/
│   │   ├── api/                    # CLICommandPort and related contracts
│   │   └── spi/                    # FileSystemPort, Cache ports, SchemaEnginePort, etc.
│   ├── adapters/
│   │   ├── api/                    # Cobra CLI today; Bubble Tea/LSP post-MVP
│   │   └── spi/
│   │       ├── cache/              # Cache adapters
│   │       ├── config/             # Configuration adapters
│   │       ├── filesystem/         # Filesystem adapters
│   │       ├── interactive/        # Interactive UI adapters
│   │       ├── schema/             # Schema loading adapters
│   │       └── template/           # Template repository adapters
│   └── shared/                     # Cross-cutting helpers (logger, errors, registry, utilities)
├── pkg/                            # Reserved for future public modules
├── templates/                      # Default template pack shipped with CLI
├── schemas/                        # User-defined schemas + property banks
├── testdata/                       # Golden vault used in automated tests (from Story 1.1)
├── .lithos/                        # Runtime cache (ignored in version control)
└── docs/                           # PRD, architecture, elicitation summaries
```

### Coding Standards Compliance

**Project Organization:** [Source: architecture/coding-standards.md]
- Application core (`internal/domain` and `internal/app`) must use Result pattern
- Ports reside under `internal/ports` (API/SPI separation)
- Adapters reside under `internal/adapters`
- No circular dependencies between adapters
- Package names must not repeat package context

**Git Configuration:**
- `.gitignore` must exclude `.lithos/cache/` directory (runtime cache)
- `.gitignore` should include standard Go patterns (vendor/, *.exe, *.test, etc.)
- Repository must be initialized if not already present

**Documentation Requirements:** [Source: architecture/coding-standards.md]
- Every package must have package comment documenting responsibility
- README.md must document prerequisites and project structure
- Architecture principles should be clearly communicated

### Previous Story Context

**Story 1.1 Insights:**
- Test vault structure has been established in `testdata/` directory
- Golden files and test patterns are available for validation
- Hexagonal architecture testing principles have been defined
- Project expects Go 1.23+ for testing improvements

### Technical Constraints

- Must use Go 1.23+ per tech stack requirements
- All paths must be cross-platform compatible (use `filepath.Join`)
- Directory structure must exactly match architecture specification
- No external dependencies in initial go.mod (stdlib first approach)
- Main.go must be compilable (basic package and main function)
- Project must be ready for future Cobra CLI integration (Story 1.8)

### File Location Standards

**Go Project Conventions:**
- `cmd/` directory for application entry points
- `internal/` for private application code (not importable externally)
- `pkg/` reserved for future public APIs
- Module name should follow domain ownership pattern

**README Documentation Requirements:**
- Prerequisites section (Go version, development tools)
- Project structure explanation with hexagonal architecture context
- Build instructions (go build, go test commands)
- Basic usage guidance for future CLI commands
- Architecture principles and contribution guidelines

## Testing

### Test Requirements

Based on testing strategy and architecture standards:

**Unit Test Coverage:**
- Project structure validation (all required directories exist)
- Go module validity (correct module name, Go version)
- .gitignore completeness (contains required patterns)
- Main.go compilation (basic syntax and package validity)

**Test Framework:** [Source: architecture/testing-strategy.md]
- Use Go stdlib `testing` package (Go 1.23+)
- Table-driven tests for directory structure validation
- File existence checks using `os.Stat`
- Go module parsing using `golang.org/x/mod/modfile`

**Integration Validation:**
- Verify project can be built with `go build ./cmd/lithos`
- Verify tests pass with `go test ./...`
- Verify linting passes (preparation for future golangci-lint)
- Verify directory structure matches architecture specification exactly

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-01-XX | 1.0 | Initial story creation | Bob (SM) |
| 2025-10-19 | 1.1 | Implemented foundational Go project setup with hexagonal architecture | James (dev) |

## Dev Agent Record

### Agent Model Used

James (Full Stack Developer)

### Debug Log References

- go version: Verified Go 1.25.3 (meets 1.23+ requirement)
- mkdir -p: Created all hexagonal architecture directories
- go build ./cmd/lithos: Verified main.go compiles successfully
- go test -mod=mod -v: All tests pass including new project structure tests

### Completion Notes List

- Updated go.mod module name to github.com/jack/lithos
- Created complete hexagonal architecture directory structure under internal/
- Added additional directories: pkg/, templates/, schemas/, .lithos/
- Updated README.md with comprehensive project documentation
- Simplified main.go to basic entrypoint with package documentation
- Added comprehensive unit tests for project structure validation
- All acceptance criteria met: go.mod, directories, README, main.go
- Tests validate directory existence, go.mod validity, .gitignore patterns, compilation, and architecture compliance

### File List

Modified:
- go.mod: Updated module name and added dependency for existing tests
- README.md: Updated with project overview, prerequisites, structure, build instructions
- cmd/lithos/main.go: Simplified to basic entrypoint with documentation
- .gitignore: Already contained required patterns including .lithos/

Created:
- internal/domain/
- internal/app/command/
- internal/app/indexing/
- internal/app/query/
- internal/app/schema/
- internal/app/template/
- internal/ports/api/
- internal/ports/spi/
- internal/adapters/api/
- internal/adapters/spi/cache/
- internal/adapters/spi/config/
- internal/adapters/spi/filesystem/
- internal/adapters/spi/interactive/
- internal/adapters/spi/schema/
- internal/adapters/spi/template/
- internal/shared/
- pkg/
- templates/
- schemas/
- .lithos/
- project_test.go: Comprehensive tests for project structure

## QA Results

_To be populated by QA agent_
